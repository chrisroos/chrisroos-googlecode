<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html>

  <head>
    <meta name="microid" content="ff511e16d7108be450fccd6f4611cf8d1d5416d1" >
    <meta http-equiv="content-type" content="text/html; charset=utf-8" >
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://feeds.feedburner.com/DeferredUntilInspirationHits" >
    <link rel="stylesheet" href="/stylesheets/yui-reset-fonts-grids.css" type="text/css" media="all">
    <link rel="stylesheet" href="/stylesheets/blog.css" type="text/css" media="all" charset="utf-8">
    <link rel="stylesheet" href="/stylesheets/syntax.css" type="text/css" media="all" charset="utf-8">
    <link rel="stylesheet" href="/stylesheets/print.css" type="text/css" media="print" charset="utf-8">
    <link rel="openid.server" href="http://www.myopenid.com/server">
    <link rel="openid.delegate" href="http://chrisroos.myopenid.com/">
    <title>Posts published in 2006 - deferred until inspiration hits</title>
  </head>
  
  <body>
    
    <div id="doc3" class="yui-t4">
      <div id="hd">
        <h1><a class="blogTitle" href="/">deferred until inspiration hits</a></h1>
      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            <div class="yui-g">

              
                <h2>
                  <a href="/articles/2006/12/24/curl-is-fast-becoming-my-favourite-toy">cURL is fast becoming my favourite toy</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sun, 24 Dec 2006 17:04:00">
                    Sun, 24 Dec 2006 17:04:00
                  </span>
                </p>

                <h3>(or programmatically logging into online banking to retrieve my balance)</h3>


	<p>In order to make practical use<sup><a href="#fn1">1</a></sup> of my new found <a href="http://blog.seagul.co.uk/articles/2006/12/14/addicted-to-twitter-com">sms gateway</a>, I&#8217;ve created a ruby script that logs into my hsbc bank account and scrapes the balance from the screen.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">COOKIE_LOCATION</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">/Users/chrisroos/hsbc_cookie</span><span class="punct">'</span>

<span class="constant">INTERNET_BANKING_ID</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_INTERNET_BANKING_ID</span><span class="punct">'</span>
<span class="constant">DATE_OF_BIRTH</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_DATE_OF_BIRTH</span><span class="punct">'</span>
<span class="constant">SECURITY_CODE</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_SECURITY_CODE</span><span class="punct">'</span>
<span class="keyword">class </span><span class="punct">&lt;&lt;</span> <span class="constant">SECURITY_CODE</span>
  <span class="punct">[</span><span class="symbol">:first</span><span class="punct">,</span> <span class="symbol">:second</span><span class="punct">,</span> <span class="symbol">:third</span><span class="punct">,</span> <span class="symbol">:fourth</span><span class="punct">,</span> <span class="symbol">:fifth</span><span class="punct">,</span> <span class="symbol">:sixth</span><span class="punct">,</span> <span class="symbol">:last</span><span class="punct">].</span><span class="ident">each_with_index</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">method</span><span class="punct">,</span> <span class="ident">index</span><span class="punct">|</span>
    <span class="ident">define_method</span><span class="punct">(</span><span class="ident">method</span><span class="punct">)</span> <span class="keyword">do</span> 
      <span class="ident">method</span> <span class="punct">==</span> <span class="symbol">:last</span> <span class="punct">?</span> <span class="constant">self</span><span class="punct">.</span><span class="ident">split</span><span class="punct">('</span><span class="string"></span><span class="punct">').</span><span class="ident">last</span> <span class="punct">:</span> <span class="constant">self</span><span class="punct">.</span><span class="ident">split</span><span class="punct">('</span><span class="string"></span><span class="punct">')[</span><span class="ident">index</span><span class="punct">]</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="comment"># POST Internet Banking ID and store the cookie</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -c&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; -L -d&quot;internetBankingID=<span class="expr">#{INTERNET_BANKING_ID}</span>&quot; &quot;https://www.ebank.hsbc.co.uk/servlet/com.hsbc.ib.app.pib.logon.servlet.OnBrochurewareLogonServlet&quot;</span><span class="punct">]</span>
`<span class="comment">#{curl_cmd}`</span>

<span class="comment"># GET Login page so that we can work out which characters it wants</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://www.ebank.hsbc.co.uk/main/IBLogon.jsp&quot;</span><span class="punct">]</span>
<span class="ident">login_page</span> <span class="punct">=</span> `<span class="comment">#{curl_cmd}`</span>

<span class="comment"># p login_page[/Please enter the (.+), (.+) and (.+) digits of your security number/]</span>
<span class="ident">c1</span> <span class="punct">=</span> <span class="ident">login_page</span><span class="punct">[/</span><span class="regex">Please enter the (.+), (.+) and (.+) digits of your security number</span><span class="punct">/,</span> <span class="number">1</span><span class="punct">].</span><span class="ident">downcase</span>
<span class="ident">c2</span> <span class="punct">=</span> <span class="ident">login_page</span><span class="punct">[/</span><span class="regex">Please enter the (.+), (.+) and (.+) digits of your security number</span><span class="punct">/,</span> <span class="number">2</span><span class="punct">].</span><span class="ident">downcase</span>
<span class="ident">c3</span> <span class="punct">=</span> <span class="ident">login_page</span><span class="punct">[/</span><span class="regex">Please enter the (.+), (.+) and (.+) digits of your security number</span><span class="punct">/,</span> <span class="number">3</span><span class="punct">].</span><span class="ident">downcase</span>
<span class="ident">tsn</span> <span class="punct">=</span> <span class="punct">[</span><span class="ident">c1</span><span class="punct">,</span> <span class="ident">c2</span><span class="punct">,</span> <span class="ident">c3</span><span class="punct">].</span><span class="ident">collect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">method</span><span class="punct">|</span> <span class="constant">SECURITY_CODE</span><span class="punct">.</span><span class="ident">__send__</span><span class="punct">(</span><span class="ident">method</span><span class="punct">)</span> <span class="punct">}.</span><span class="ident">join</span>
<span class="comment"># p tsn</span>

<span class="comment"># POST to login now that we've (hopefully) created the tsn</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; -L -d&quot;dateOfBirth=<span class="expr">#{DATE_OF_BIRTH}</span>&quot; -d&quot;tsn=<span class="expr">#{tsn}</span>&quot; &quot;https://www.ebank.hsbc.co.uk/servlet/com.hsbc.ib.app.pib.logon.servlet.OnLogonVerificationServlet&quot;</span><span class="punct">]</span>
`<span class="comment">#{curl_cmd}`</span>

<span class="comment"># GET the account overview page to scrape the balance from it</span>
<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl -s -b&quot;<span class="expr">#{COOKIE_LOCATION}</span>&quot; &quot;https://www.ebank.hsbc.co.uk/main/portmain.jsp&quot;</span><span class="punct">]</span>
<span class="ident">account_overview_html</span> <span class="punct">=</span> `<span class="comment">#{curl_cmd}`</span>

<span class="comment"># Remove the cookie</span>
`<span class="ident">rm</span> <span class="comment">#{COOKIE_LOCATION}`</span>

<span class="comment"># Obtain and display the account balance</span>
<span class="ident">account_balance</span> <span class="punct">=</span> <span class="ident">account_overview_html</span><span class="punct">[/</span><span class="regex">&lt;td.*?&gt;(<span class="escape">\d</span>+.?<span class="escape">\d</span>+?<span class="escape">\s</span>*C|D)&lt;<span class="escape">\/</span>td&gt;</span><span class="punct">/,</span> <span class="number">1</span><span class="punct">]</span>
<span class="ident">puts</span> <span class="ident">account_balance</span></code></pre></div>

	<p id="fn1"><sup>1</sup>  I will probably never ever use this.  Oh well.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/cool" rel="tag">cool</a>, 
                    
                      <a href="/articles/tag/curl" rel="tag">curl</a>, 
                    
                      <a href="/articles/tag/hack" rel="tag">hack</a>, 
                    
                      <a href="/articles/tag/hsbc" rel="tag">hsbc</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/12/24/the-worst-captcha-ever">The worst captcha... ever.</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sun, 24 Dec 2006 11:02:00">
                    Sun, 24 Dec 2006 11:02:00
                  </span>
                </p>

                <p><img src="http://farm1.static.flickr.com/134/331689212_67bd78ce15_o.jpg" alt="" /></p>


	<p>And, from a <a href="http://www.shozu.com">site</a> that requires your mobile number as part of the signup process &#8211; seems to me that they&#8217;d be better off using that to filter automated signups.</p>


	<p>I hate captchas.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/captcha" rel="tag">captcha</a>, 
                    
                      <a href="/articles/tag/crap" rel="tag">crap</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/12/15/might-as-well-aim-high">Might as well aim high...</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 15 Dec 2006 17:07:00">
                    Fri, 15 Dec 2006 17:07:00
                  </span>
                </p>

                <p><img src="http://static.flickr.com/130/323149762_31ae107670_o.png" alt="" /></p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/google" rel="tag">google</a>, 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                      <a href="/articles/tag/review" rel="tag">review</a>, 
                    
                      <a href="/articles/tag/worlddomination" rel="tag">worlddomination</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/12/14/addicted-to-twitter-com">Addicted to twitter.com</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 14 Dec 2006 14:42:00">
                    Thu, 14 Dec 2006 14:42:00
                  </span>
                </p>

                <p>But not because of a craving to be loved.  Honest.  For a long time I&#8217;ve wanted to be able to interact with a computer/remote process via sms.  Just this morning I was struck with what I thought was an amazing idea.  I&#8217;d heard of <a href="http://www.twitter.com">twitter</a> and wondered if I might be able to use it as a type of sms gateway.  Turns out that I could.  Yay.</p>


	<p>To play along, you will need:</p>


	<ul>
	<li>One twitter account with a registered mobile</li>
		<li>One twitter account that is a friend of the first account (with the mobile)</li>
		<li>A tiny bit of ruby script</li>
	</ul>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">rubygems</span><span class="punct">'</span>
<span class="ident">require</span> <span class="punct">'</span><span class="string">json</span><span class="punct">'</span>

<span class="constant">RECEIVER_USERNAME</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">USERNAME_OF_MOBILE_ACCOUNT</span><span class="punct">'</span>
<span class="constant">RECEIVER_PASSWORD</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">PASSWORD_OF_MOBILE_ACCOUNT</span><span class="punct">'</span>
<span class="ident">js</span> <span class="punct">=</span> `<span class="ident">curl</span> <span class="punct">-</span><span class="ident">u</span><span class="punct">&quot;</span><span class="string"><span class="expr">#{RECEIVER_USERNAME}</span>:<span class="expr">#{RECEIVER_PASSWORD}</span></span><span class="punct">&quot;</span> <span class="ident">http</span><span class="punct">:/</span><span class="regex"></span><span class="punct">/</span><span class="ident">twitter</span><span class="punct">.</span><span class="ident">com</span><span class="punct">/</span><span class="ident">statuses</span><span class="punct">/</span><span class="ident">friends_timeline</span><span class="punct">.</span><span class="ident">json`</span>

<span class="ident">text</span> <span class="punct">=</span> <span class="constant">JSON</span><span class="punct">.</span><span class="ident">parse</span><span class="punct">(</span><span class="ident">js</span><span class="punct">).</span><span class="ident">first</span><span class="punct">['</span><span class="string">text</span><span class="punct">']</span>

<span class="constant">SENDER_USERNAME</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">USERNAME_OF_FRIEND</span><span class="punct">'</span>
<span class="constant">SENDER_PASSWORD</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">PASSWORD_OF_FRIEND</span><span class="punct">'</span>

`<span class="ident">curl</span> <span class="punct">-</span><span class="ident">u</span><span class="punct">&quot;</span><span class="string"><span class="expr">#{SENDER_USERNAME}</span>:<span class="expr">#{SENDER_PASSWORD}</span></span><span class="punct">&quot;</span> <span class="punct">-</span><span class="ident">d</span><span class="punct">&quot;</span><span class="string">status=<span class="expr">#{text.reverse}</span></span><span class="punct">&quot;</span> <span class="ident">http</span><span class="punct">:/</span><span class="regex"></span><span class="punct">/</span><span class="ident">twitter</span><span class="punct">.</span><span class="ident">com</span><span class="punct">/</span><span class="ident">statuses</span><span class="punct">/</span><span class="ident">update</span><span class="punct">.</span><span class="ident">xml`</span></code></pre></div>

	<p>The script just reads the most recent message sent to your mobile twitter account, reverses the text and sends it back to your mobile.</p>


	<p>This is all free stuff, and although the twitter terms of service don&#8217;t appear to explicitly disallow us doing this, I think you should probably be nice if you&#8217;re going to use it in this way.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/sms" rel="tag">sms</a>, 
                    
                      <a href="/articles/tag/twitter" rel="tag">twitter</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/12/13/reevoo-com-dips-its-toes-into-the-opensearch-water">Reevoo.com dips its toes into the opensearch water</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 13 Dec 2006 21:37:00">
                    Wed, 13 Dec 2006 21:37:00
                  </span>
                </p>

                <p>So.  What does that mean exactly?  Well, right at the moment, not a great deal.  It pretty much means that you can add the ability to search reevoo.com to the Firefox 2 and <span class="caps">IE7</span> browsers very easily.  Visiting <a href="http://www.reevoo.com">reevoo.com</a> with either of these browsers will highlight part of the &#8216;search box&#8217;.</p>


	<p><img src="http://static.flickr.com/126/321626445_dfe00b4e0e.jpg?v=0" alt="" /></p>


	<p><span class="caps">IE 7</span> changes the little arrow to a goldy, orangey, yellowy type colour to indicate the presence of an opensearch enabled search engine.</p>


	<p><img src="http://static.flickr.com/132/321626424_d6ec54a53b.jpg?v=0" alt="" /></p>


	<p>While Firefox 2 opts for a blue surround and additionally chooses to add our logo.  Woot.</p>


	<h3>I appreciate that I can now easily search reevoo from anywhere but was it really worth a blog post?</h3>


	<p>Hmm, interesting question (that wasn&#8217;t an actual question, I just made it up).</p>


	<p>Actually, I think that <a href="http://www.opensearch.org">opensearch</a> is pretty cool.  At the moment, we are just exposing our search results in their html form.  Just imagine, for a second, that we were instead, exposing our results as <a href="http://en.wikipedia.org/wiki/Atom_%28standard%29">atom</a> or <a href="http://en.wikipedia.org/wiki/RSS_%28file_format%29">rss</a> feeds.  Now, also imagine<sup><a href="#fn1">1</a></sup> that retailers felt like being a little more open; and, as such, were offering an opensearch description of their search capabilities, along with search results in atom or rss feeds.  All we&#8217;d need then was an <a href="http://a9.com">aggregator</a> that would allow us to search for products across our chosen retailers and reevoo in one go.  The result would be a page containing both product reviews and pricing and stock availability from each retailer.  That, I think, would be pretty damn cool.</p>


	<p id="fn1"><sup>1</sup> Currently, this requires a lot of imagination.  A quick browse this afternoon found four big retailers that don&#8217;t even have working search without javascript enabled.  At least they&#8217;ve got <a href="http://www.w3.org/Provider/Style/URI">well</a> <a href="http://wiki.welldesignedurls.org/Main_Page">designed</a> urls.  Oh, hang on&#8230;</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/atom" rel="tag">atom</a>, 
                    
                      <a href="/articles/tag/opensearch" rel="tag">opensearch</a>, 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                      <a href="/articles/tag/search" rel="tag">search</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/12/10/crappy-ruby-script-to-download-photos-from-a-flickr-photoset">Crappy ruby script to download photos from a flickr photoset</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sun, 10 Dec 2006 16:55:00">
                    Sun, 10 Dec 2006 16:55:00
                  </span>
                </p>

                <p>So, it seems far more difficult than it should be to retrieve a bunch of <strong>my</strong> photos from flickr.com.  Having unsuccessfully experimented with some of the flickr libs on <a href="http://www.rubyforge.org">rubyforge</a> I hacked this together.</p>


	<p><strong><span class="caps">UPDATE</span></strong>: Something caused curl to get &#8216;stuck&#8217; downloading a particular picture so I amended the script to ensure it ignores already downloaded files.</p>


	<p><strong><span class="caps">UPDATE 2</span></strong>: Surround output filename with quotes.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">cgi</span><span class="punct">'</span>

<span class="constant">API_KEY</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_API_KEY</span><span class="punct">'</span>
<span class="constant">PHOTOSET_ID</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_PHOTOSET_ID</span><span class="punct">'</span>
<span class="constant">LOCAL_PHOTO_DIR</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">/users/chrisroos/desktop/photos/</span><span class="punct">'</span>

<span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl &quot;http://api.flickr.com/services/rest/?method=flickr.photosets.getPhotos&amp;api_key=<span class="expr">#{API_KEY}</span>&amp;photoset_id=<span class="expr">#{PHOTOSET_ID}</span>&quot;</span><span class="punct">]</span>
<span class="ident">photoset_photos</span> <span class="punct">=</span> `<span class="comment">#{curl_cmd}`</span>

<span class="ident">number_of_photos</span> <span class="punct">=</span> <span class="ident">photoset_photos</span><span class="punct">.</span><span class="ident">scan</span><span class="punct">(/</span><span class="regex">&lt;photo .*&gt;</span><span class="punct">/).</span><span class="ident">size</span>
<span class="ident">current_photo</span> <span class="punct">=</span> <span class="number">0</span>

<span class="ident">photoset_photos</span><span class="punct">.</span><span class="ident">scan</span><span class="punct">(/</span><span class="regex">&lt;photo .*&gt;</span><span class="punct">/)</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">line</span><span class="punct">|</span>
  <span class="ident">current_photo</span> <span class="punct">+=</span> <span class="number">1</span>

  <span class="ident">photo_id</span> <span class="punct">=</span> <span class="ident">line</span><span class="punct">[/</span><span class="regex">id=&quot;(<span class="escape">\d</span>+)&quot;</span><span class="punct">/,</span> <span class="number">1</span><span class="punct">]</span>
  <span class="ident">photo_secret</span> <span class="punct">=</span> <span class="ident">line</span><span class="punct">[/</span><span class="regex">secret=&quot;(<span class="escape">\w</span>+)&quot;</span><span class="punct">/,</span> <span class="number">1</span><span class="punct">]</span>
  <span class="ident">photo_server</span> <span class="punct">=</span> <span class="ident">line</span><span class="punct">[/</span><span class="regex">server=&quot;(<span class="escape">\d</span>+)&quot;</span><span class="punct">/,</span> <span class="number">1</span><span class="punct">]</span>
  <span class="ident">photo_title</span> <span class="punct">=</span> <span class="ident">line</span><span class="punct">[/</span><span class="regex">title=&quot;(.+?)&quot;</span><span class="punct">/,</span> <span class="number">1</span><span class="punct">]</span>

  <span class="ident">url</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">http://static.flickr.com/<span class="expr">#{photo_server}</span>/<span class="expr">#{photo_id}</span>_<span class="expr">#{photo_secret}</span>_o_d.jpg</span><span class="punct">&quot;</span>
  <span class="ident">filename</span> <span class="punct">=</span> <span class="constant">CGI</span><span class="punct">.</span><span class="ident">unescapeHTML</span><span class="punct">(</span><span class="ident">photo_title</span><span class="punct">).</span><span class="ident">gsub</span><span class="punct">(/</span><span class="regex"> |&amp;|,|-</span><span class="punct">/,</span> <span class="punct">'</span><span class="string">_</span><span class="punct">').</span><span class="ident">gsub</span><span class="punct">(/</span><span class="regex">'</span><span class="punct">/,</span> <span class="punct">'</span><span class="string"></span><span class="punct">').</span><span class="ident">downcase</span><span class="punct">.</span><span class="ident">squeeze</span><span class="punct">('</span><span class="string">_</span><span class="punct">')</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">_</span><span class="punct">'</span> <span class="punct">+</span> <span class="ident">photo_id</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">.jpg</span><span class="punct">'</span> <span class="comment"># Sanitize title to use as filename</span>
  <span class="ident">filepath</span> <span class="punct">=</span> <span class="constant">LOCAL_PHOTO_DIR</span> <span class="punct">+</span> <span class="ident">filename</span>

  <span class="keyword">if</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">exists?</span><span class="punct">(</span><span class="ident">filepath</span><span class="punct">)</span>
    <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Skipping photo (already downloaded) <span class="expr">#{current_photo}</span> of <span class="expr">#{number_of_photos}</span></span><span class="punct">&quot;</span>
  <span class="keyword">else</span>
    <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">Retrieving photo <span class="expr">#{current_photo}</span> of <span class="expr">#{number_of_photos}</span></span><span class="punct">&quot;</span>
    <span class="ident">curl_cmd</span> <span class="punct">=</span> <span class="punct">%[</span><span class="string">curl &quot;<span class="expr">#{url}</span>&quot; &gt; &quot;<span class="expr">#{filepath}</span>&quot;</span><span class="punct">]</span>
    `<span class="comment">#{curl_cmd}`</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/crap" rel="tag">crap</a>, 
                    
                      <a href="/articles/tag/curl" rel="tag">curl</a>, 
                    
                      <a href="/articles/tag/flickr" rel="tag">flickr</a>, 
                    
                      <a href="/articles/tag/regex" rel="tag">regex</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/11/29/del-icio-us-as-a-simple-to-do-list">del.icio.us as a simple to do list</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 29 Nov 2006 21:37:00">
                    Wed, 29 Nov 2006 21:37:00
                  </span>
                </p>

                <p>I often come across resources on the web that I&#8217;m interested in but want to look at in more detail later.  I currently use a combination of: storing urls in text files, placing links in my <a href="http://www.backpackit.com">backpack</a>, storing bookmarks in my browser and, in the past, tagging links with <a href="http://del.icio.us/tag/to_read">to_read</a> in <a href="http://del.icio.us">del.icio.us</a>.  I inevitably end up forgetting where I&#8217;ve stored these &#8216;bookmarks&#8217; and therefore miss out on that resource<sup><a href="#fn1">1</a></sup>.  In an attempt to consolidate places I can hide information, I&#8217;ve created a todo bundle in del.icio.us that currently contains the to_watch and to_read tags.  Doing that today ensured that I remembered to watch a <a href="http://www.identity20.com/media/OSCON2005/">great presentation</a> by <a href="http://blame.ca/dick/">Dick Hardt</a> on the subject of <a href="http://www.identity20.com">identity 2.0</a>.  Cool.</p>


	<p id="fn1"><sup>1</sup> You could probably argue that because I forget about the resource, I can&#8217;t have been <em>that</em> interested in the first place&#8230;</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/del.icio.us" rel="tag">del.icio.us</a>, 
                    
                      <a href="/articles/tag/todo" rel="tag">todo</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/11/28/amazing-non-customer-service">Amazing non-customer service</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 28 Nov 2006 23:55:00">
                    Tue, 28 Nov 2006 23:55:00
                  </span>
                </p>

                <p>I heard (well, read) about <a href="http://www.wesabe.com">wesabe</a> this morning and thought I&#8217;d sign-up to find out what it was all about.  During the sign-up process I was asked for <em>two</em> security questions and answers &#8211; to be used in the event of me forgetting my password.  Although I was unable<sup><a href="#fn1">1</a></sup> to sign-up and use the service, I still got an amazing &#8216;non-customer experience&#8217;.  I was curious as to why they wanted me to answer two security questions in order to sign-up, and emailed them to that affect.</p>


	<blockquote>
		<p>I was about to signup to wesabe but I&#8217;ve been rejected by not entering my security questions.  I&#8217;m genuinely interested in your decision to require two security questions as well as an email address.  I get the impression that the current trend is to ask for an email address and provide a &#8216;reset password&#8217; type link that mails out a new password &#8211; maybe you are more aware of this due to the type of data being stored?</p>
	</blockquote>


	<p>That was sent at 08:14.  This reply was received at 08:19.</p>


	<blockquote>
		<p>Yes, your guess is spot on.  During our preview/beta period, one of the most common requests we had was for password resets.  It was easy enough to verify the source of those requests when we knew all of our users, but as the preview group grew, we weren&#8217;t able to confirm that we were actually resetting a password for the right person.  When we talked it over, we decided to use the model set by PayPal, since that seemed like the closest analog to our service in web applications.  Using a combination of security questions and access to a set email address provides two levels of authentication, and that&#8217;s what we wanted.</p>
	</blockquote>


	<blockquote>
		<p>I really want signup to be easier and faster, and yet still have people be able to get back to their data &#8211; and only their data &#8211; whenever they want.  I&#8217;m not happy with the length of the signup form, but it seems better than other options I&#8217;ve found so far.</p>
	</blockquote>


	<blockquote>
		<p>If you have suggestions or comments on this, I&#8217;d be very interested.</p>
	</blockquote>


	<p>Whoah.  That&#8217;s pretty cool.  Right!?  I&#8217;ve actually had a very similar experience with <a href="http://www.claimid.com">claimid</a>.  I asked them to <a href="http://blog.claimid.com/2006/05/tips-and-tricks-your-name-in-the-url/">change my username</a> and the response confirming their action was through within ten minutes.</p>


	<p>In a &#8220;we wanna be that cool too&#8221; stylee, I&#8217;m opening myself up to spam galore<sup><a href="#fn2">2</a></sup> by offering my email address for your delectation:</p>


	<p><a href="mailto:chrisroos@reevoo.com">chrisroos@reevoo.com</a></p>


	<p>Feel free to email me, why not.</p>


	<p>[1] There&#8217;s a little white lie there to be fair.  Of course I <em>could&#8217;ve</em> signed up.  They didn&#8217;t put a spell on me (although that&#8217;d be cool) or anything.  It&#8217;s just that I feel uncomfortable giving out the answers to real questions (mother&#8217;s maiden name) and there&#8217;s zero chance of me remembering the answer to made up questions (favourite colour/day/smell).</p>


	<p>[2] I was going to cleverly protect my email addresses from prying robot eyes&#8230;  but really can&#8217;t be bothered.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/claimid" rel="tag">claimid</a>, 
                    
                      <a href="/articles/tag/open" rel="tag">open</a>, 
                    
                      <a href="/articles/tag/reevoo" rel="tag">reevoo</a>, 
                    
                      <a href="/articles/tag/wesabe" rel="tag">wesabe</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/11/27/maybe-i-need-some-more-rest">Maybe I need some more REST</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 27 Nov 2006 22:26:00">
                    Mon, 27 Nov 2006 22:26:00
                  </span>
                </p>

                <p>This post isn&#8217;t about sleep deprevation.  Instead, the witty title is referring to everyone&#8217;s newest, favouritist buzzword: <a href="http://www.wikipedia.org/wiki/REST"><span class="caps">REST</span></a> (or Representational State Transfer).</p>


	<p>Scene setting with some things that have happened recently (in roughly this order):</p>


	<ul>
	<li><a href="http://www.reevoo.com/blogs/bengriffiths/">Ben</a> mentions that we need to think about splitting our application up to better distribute the load on servers.  I don&#8217;t completely &#8216;get it&#8217;.</li>
		<li><a href="http://www.rubyonrails.com">Rails</a> gets <a href="http://www.wikipedia.org/wiki/REST"><span class="caps">REST</span></a> support <a href="http://www.ryandaigle.com/articles/2006/08/01/whats-new-in-edge-rails-simply-restful-support-and-how-to-use-it">baked in</a> (Ok, so this is pretty old news now)</li>
		<li>We spent quite a lot of time at <a href="http://www.reevoo.com">work</a> writing code to access the <a href="http://adwords.google.com">google adwords</a> <a href="http://www.google.com/apis/adwords/">soap api</a></li>
		<li>I finally got (thanks to <a href="http://blog.floehopper.org">James</a>) why <a href="http://habtm.com/articles/2006/07/01/if-your-models-arent-namespaced-why-should-your-controllers-be-or-how-i-learned-to-stop-worrying-and-love-the-crud">some</a> rails folk have stated that following a RESTful design frees them up from having namespaced admin controllers.</li>
		<li>I spent quite a bit of time over the last two weeks really looking into the <a href="http://www.ietf.org/rfc/rfc4287.txt">atom syndication format</a> and <a href="http://www.ietf.org/internet-drafts/draft-ietf-atompub-protocol-11.txt">atom publishing protocol</a></li>
		<li>I spent a few hours at the weekend playing with the <a href="http://www.amazon.com/s3">amazon s3</a> service</li>
		<li><a href="http://wanderingbarque.com/nonintersecting/2006/11/15/the-s-stands-for-simple/">This</a> popped up recently and got an incredible amount of attention.</li>
		<li>I read an <a href="http://www.acmqueue.com/modules.php?name=Content&#38;pa=showpage&#38;pid=388">interview</a> with <a href="http://www.allthingsdistributed.com/">Werner Vogel</a> (CTO of Amazon) that talks about everything being a service.  One quote in particular caught my attention.</li>
	</ul>


	<blockquote>
		<p>If you hit the Amazon.com gateway page, the application calls more than 100 services to collect data and construct the page for you.</p>
	</blockquote>


	<ul>
	<li>I took the plunge and just about stayed awake through <a href="http://roy.gbiv.com/pubs/dissertation/top.htm">The Document</a>.  I found chapter 6 (and in particular 6.3.4) the most relevant as it explains <span class="caps">REST</span> in the context of the <span class="caps">URI</span> and <span class="caps">HTTP</span>.  I tend to drift off on when things are explained without real examples.</li>
		<li>I watched <a href="http://nubyonrails.com">Geoffrey Grosenbach&#8217;s</a> <a href="http://www.peepcode.org">peepcode</a> screencast on <a href="http://peepcode.com/articles/2006/10/08/restful-rails">restful rails</a>.</li>
		<li>I worked out how to use <a href="http://del.icio.us">del.icio.us</a> and subscribed to some of the tags (keywords) mentioned above.</li>
	</ul>


	<p>Wow.  You&#8217;d think with all that reading, listening and viewing I&#8217;d be right up on the subject.  Sadly I don&#8217;t feel as though that&#8217;s quite the case.</p>


	<p>Now.  I do see an advantage of a RESTful approach (particular the style currently advocated in <a href="http://www.rubyonrails.com">rails</a>), over <span class="caps">SOAP</span>, when dealing with something like the google adwords api<sup><a href="#fn1">1</a></sup>.  But, what about services like currency conversion and syntax highlighting?  I can&#8217;t get these to fit into a RESTful style in my head (I guess I can&#8217;t find the resource in each case).  Instead, I see them as analogous to unix command line applications: pipe simple data in (an amount with two curencies or ruby code) and get simple data out (an amount in the new currency or syntax-highlighted ruby code).  Actually, I see them as remote procedure calls.  Are these types of services incompatible with the <span class="caps">REST</span> architectural style or have I missed something?  I&#8217;m starting to wonder if I&#8217;m getting too hung up on <span class="caps">REST</span> = <span class="caps">CRUD</span> and therefore missing some of the more fundamental points.  Either way, I definitely feel that it&#8217;d be good to see some more concrete examples in the <span class="caps">REST</span> vs <span class="caps">SOAP</span>/RPC/SOA arguments.  As stated above, I&#8217;m not so great in the abstract.</p>


	<p id="fn1"><sup>1</sup> I had a few problems when interacting with the adwords api.  I don&#8217;t, however, feel that I have enough information to know whether the pain was caused by <a href="http://dev.ctor.org/soap4r">soap4r</a>, <a href="http://en.wikipedia.org/wiki/SOAP">soap</a>, the <a href="http://www.google.com/apis/adwords/">api</a> or just my lack of knowledge.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/rest" rel="tag">rest</a>, 
                    
                      <a href="/articles/tag/rpc" rel="tag">rpc</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/soap" rel="tag">soap</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/11/07/telephone-numbers-for-form-submissions">Telephone numbers for form submissions</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 07 Nov 2006 23:04:00">
                    Tue, 07 Nov 2006 23:04:00
                  </span>
                </p>

                <p>I don&#8217;t like giving out my real contact details in surveys / on-line forms, particularly telephone numbers.  I&#8217;m not an amazing fan of the telephone and as such very rarely (unless-I&#8217;m-really-certain-I-know-who-is-calling-and-even-then-it&#8217;s-not-guaranteed) answer it.  For this reason, I feel fairly justified in not wanting to enter my number into surveys / on-line forms.  I&#8217;m also pretty confident that the number of people that actually <em>need</em> a number to contact me on, are very very very few and far between.  So, if they don&#8217;t need my number, I guess they are either following the crowd, &#8220;but all the other forms ask for it&#8221;, or, they want to do bad things with it.  Either way, I&#8217;d rather they didn&#8217;t have it.</p>


	<p>There is a point (and a link no-less) to this rant.  Honest.  Wait.  It&#8217;s coming&#8230;</p>


	<p><a href="http://www.ofcom.org.uk/telecoms/ioi/numbers/num_drama">Ofcom&#8217;s list of reserved numbers for official form filling in use<sup><a href="#fn1">1</a></sup></a></p>


	<p>I remembered this from the oftel days of yore but had been unable to find it in more recent searches.  Luckily, <a href="http://en.wikipedia.org/wiki/UK_telephone_numbering_plan">wikipedia</a> came to the rescue this evening<sup><a href="#fn2">2</a></sup>.</p>


	<p id="fn1"><sup>1</sup> That&#8217;s quite clearly not their actual intended purpose.  Right.</p>


	<p id="fn2"><sup>2</sup> In the past, when requested for landline number, I&#8217;ve entered my, relatively recently disconnected, landline number.  There&#8217;s every chance that this has been (or is scheduled to be) re-allocated &#8211; prompting me to find a new number.</p>

                
              
                <h2>
                  <a href="/articles/2006/11/01/google-adwords-api-internal-error-using-the-sandbox">Google AdWords Api Internal Error using the Sandbox</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 01 Nov 2006 09:01:00">
                    Wed, 01 Nov 2006 09:01:00
                  </span>
                </p>

                <p>This has come up on the <a href="http://groups-beta.google.com/group/adwords-api">list</a> a few times.</p>


	<p>I&#8217;ve personally found it to occur when the sandbox gets reset (i.e. data from the sandbox is deleted by google).  The solution in this instance is to remove the clientEmail from the soap headers.  Make one request without it and then you can add it back in again.  I guess it&#8217;s to do with the way that the accounts get auto created on the first request.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/adwords" rel="tag">adwords</a>, 
                    
                      <a href="/articles/tag/api" rel="tag">api</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/10/24/connecting-to-gmail-with-ruby-or-connecting-to-pop3-servers-over-ssl-with-ruby">Connecting to gmail with Ruby (or Connecting to POP3 servers over SSL with Ruby)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 24 Oct 2006 22:42:00">
                    Tue, 24 Oct 2006 22:42:00
                  </span>
                </p>

                <h3>Short version (or, &#8220;I want to connect to gmail <span class="caps">NOW</span>&#8221;)</h3>


	<ul>
	<li>Download the <a href="http://ruby-doc.org/stdlib-1.9/libdoc/net/pop/rdoc/index.html">pop3 library</a> from <a href="http://www.ruby-lang.org/cgi-bin/cvsweb.cgi//?only_with_tag=HEAD">Ruby <span class="caps">HEAD</span></a> (Ruby 1.9) (<a href="http://www.ruby-lang.org/cgi-bin/cvsweb.cgi/~checkout~/ruby/lib/net/pop.rb?rev=1.73;content-type=application%2Fx-ruby;only_with_tag=HEAD">download file</a>)</li>
		<li>Use the following script to get started (making sure that you explicitly reference the downloaded pop3 file)...</li>
	</ul>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">pop_ssl</span><span class="punct">'</span> <span class="comment"># I renamed the file from pop.rb to pop_ssl.rb to ensure I was requiring the correct version</span>

<span class="ident">username</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_GMAIL_USERNAME@gmail.com</span><span class="punct">'</span>
<span class="ident">password</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">YOUR_GMAIL_PASSWORD</span><span class="punct">'</span>

<span class="constant">Net</span><span class="punct">::</span><span class="constant">POP3</span><span class="punct">.</span><span class="ident">enable_ssl</span><span class="punct">(</span><span class="constant">OpenSSL</span><span class="punct">::</span><span class="constant">SSL</span><span class="punct">::</span><span class="constant">VERIFY_NONE</span><span class="punct">)</span>
<span class="constant">Net</span><span class="punct">::</span><span class="constant">POP3</span><span class="punct">.</span><span class="ident">start</span><span class="punct">('</span><span class="string">pop.gmail.com</span><span class="punct">',</span> <span class="number">995</span><span class="punct">,</span> <span class="ident">username</span><span class="punct">,</span> <span class="ident">password</span><span class="punct">)</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">pop</span><span class="punct">|</span>
  <span class="keyword">if</span> <span class="ident">pop</span><span class="punct">.</span><span class="ident">mails</span><span class="punct">.</span><span class="ident">empty?</span>
    <span class="ident">puts</span> <span class="punct">'</span><span class="string">No mail.</span><span class="punct">'</span>
  <span class="keyword">else</span>
    <span class="ident">pop</span><span class="punct">.</span><span class="ident">each_mail</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">mail</span><span class="punct">|</span>
      <span class="ident">p</span> <span class="ident">mail</span><span class="punct">.</span><span class="ident">header</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<h3>Medium version (or, &#8220;Let me know I&#8217;m connecting to the correct site, Dammit&#8221;)</h3>


	<p>This is identical to the short version except that we verify the ssl certificate this time round.</p>


	<ul>
	<li>Follow the first step above (i.e. download new version of pop3 lib).</li>
		<li>Download the CA Root Certificates bundle from <a href="http://curl.haxx.se/">cURL site</a> (<a href="http://curl.haxx.se/ca/cacert.pem">download file</a>)</li>
		<li>Copy the code above but change the Net::POP3.enable_ssl line to read&#8230;</li>
	</ul>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Net</span><span class="punct">::</span><span class="constant">POP3</span><span class="punct">.</span><span class="ident">enable_ssl</span><span class="punct">(</span><span class="constant">OpenSSL</span><span class="punct">::</span><span class="constant">SSL</span><span class="punct">::</span><span class="constant">VERIFY_PEER</span><span class="punct">,</span> <span class="punct">'</span><span class="string">/PATH/TO/DOWNLOADED/cacert.pem</span><span class="punct">')</span></code></pre></div>

	<h3>Longer version (or, &#8220;Pray tell, how did you find this information sir&#8221;)</h3>


	<p>An explanation of how I got here.  Feel free to ignore.</p>


	<p>For a while I&#8217;ve wanted to play around with receiving emails within a <a href="http://www.rubyonrails.org">rails</a> app (with <a href="http://am.rubyonrails.org/files/README.html">action mailer</a>).  I had an hour or two free the other evening and so started to play.  First step was to take a look at the <a href="http://wiki.rubyonrails.org">rails wiki</a> and see that there&#8217;s already a <a href="http://wiki.rubyonrails.org/rails/pages/HowToReceiveEmailsWithActionMailer">page</a> detailing exactly what I wanted to do.  As I started reading, I was getting put off by the thought of configuring <a href="http://www.sendmail.org">sendmail</a> or some other &#8216;heavyweight&#8217; solution.  Luckily, someone has added a much better suggestion at the bottom of the page &#8211; using <a href="http://ruby-doc.org/stdlib/libdoc/net/pop/rdoc/index.html">net/pop</a> (or <a href="http://ruby-doc.org/stdlib/libdoc/net/imap/rdoc/index.html">net/imap</a>) to collect emails from a pre-configured mail server.  Although I use <a href="http://www.fastmail.co.uk">imap</a> for my own email provision, I wanted a pop server for testing.  Aha, I thought, I&#8217;ll just set-up another <a href="http://www.gmail.com">gmail</a> account and use that&#8230;  And that&#8217;s where the problems started.</p>


	<p>You see, gmail only accepts <a href="http://en.wikipedia.org/wiki/POP3"><span class="caps">POP3</span></a> connections over <a href="http://en.wikipedia.org/wiki/SSL"><span class="caps">SSL</span></a> (on port 995), a feature not found in our beloved net/pop library.  Hmm.  Time for some help from google.  The first page I <a href="http://involution.com/2006/07/20/access-gmail-from-ruby-using-netpop3-and-stunnel/">came across</a> described using <a href="http://www.stunnel.org">stunnel</a> to create an ssl tunnel to route standard net/pop traffic through.  This sounded great, except that I couldn&#8217;t get stunnel (v4.16) to compile on mac os x, although I didn&#8217;t try too hard&#8230;  The other point of interest in that original article was that the pop3 with ssl support was in development.  The next step was to track down some mailing list threads that talked about the ssl support and hope for a patch.  We&#8217;re in luck, the <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/2703">first patch</a> was actually submitted in March 2004, with the second, accepted and committed, <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/2745">patch</a> coming in April 2004.  As per the <a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-core/2780">last message</a> in the second thread, the patch was accepted into core, and is now available in the 1.9 release.  So, we don&#8217;t even need to patch our existing copy of net/pop, we can just download the newer version.  I named this downloaded version as pop_ssl, to avoid confusion, and placed it in my ruby load path.</p>


	<p>Next step was to follow the example on the <a href="http://ruby-doc.org/stdlib-1.9/libdoc/net/pop/rdoc/classes/Net/POP3.html">net/pop3 page</a>, and, with the addition of the Net::POP3::enable_ssl directive, try to connect.  Hmm, things still weren&#8217;t working quite right.  I was getting the following error.</p>


<div class="typocode"><pre><code class="typocode_default">OpenSSL::SSL::SSLError: certificate verify failed</code></pre></div>

	<p>Some more googling led me to <a href="http://ghouston.blogspot.com/2006/03/using-ssl-with-ruby-http-access2.html">this post</a> by <a href="http://ghouston.blogspot.com/">Greg Houston</a>.  It turns out that the error is actually raised in the <a href="http://www.openssl.org">OpenSSL</a> layer.  It is caused by us trying to verify the server certificate without having the correct trusted root certificate.  It turns out that we can either disable the verification (by using <code>Net::POP3::enable_ssl(OpenSSL::SSL::VERIFY_NONE)</code>), or we can verify against a trusted root certificate bundle, like the one <a href="http://curl.haxx.se/docs/caextract.html">supplied</a> by cURL.  To verify using the certificate bundle from cURL (or similar), we would amend the above line of code to <code>Net::POP3.enable_ssl(OpenSSL::SSL::VERIFY_PEER, File.dirname(__FILE__) + '/PATH/TO/DOWNLOADED/cacert.pem')</code>.</p>


	<p>I can finally now get on with my rails app to retrieve emails from gmail.</p>


	<h3>Conclusion</h3>


	<ul>
	<li>I&#8217;ve spent a lot more than the intended couple of hours investigating this stuff, yet still have no rails app receiving emails (although I&#8217;m a lot closer now&#8230;)</li>
		<li>There&#8217;s very little information on the ssl enabled libraries (net/https, net/pop, http-access2 to name but a few) in ruby.  Maybe everybody else just knows about this stuff already, but I&#8217;m certainly pretty unclear.</li>
		<li>I have a feeling that it should be possible to use net/https to connect (unverified) to a site that uses ssl and obtain the certificate for use in subsequent verified connections.  Indeed, another <a href="http://curl.haxx.se/docs/sslcerts.html">document</a> hosted on curl.haxx.se seems to indicate that this is possible.</li>
		<li>I still know very little about ssl and certificates.</li>
		<li>I hope that what little information is here can help someone else in a similar situation.</li>
	</ul>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/gmail" rel="tag">gmail</a>, 
                    
                      <a href="/articles/tag/pop" rel="tag">pop</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/10/20/boolean-method-in-ruby-sibling-of-array-float-integer-and-string">Boolean method in Ruby (sibling of Array, Float, Integer and String) </a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 20 Oct 2006 00:19:00">
                    Fri, 20 Oct 2006 00:19:00
                  </span>
                </p>

                <p>I was reading in data from a file and expected one particular column to contain either &#8216;true&#8217; or &#8216;false&#8217;.  I wanted a nice way to convert the string representation into its object counterpart.  I thought to the Kernel#Float (and kin) and decided I wanted a Kernel#Boolean method.  So I made one.  Tada&#8230;</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">module </span><span class="module">Kernel</span>

  <span class="keyword">def </span><span class="method">Boolean</span><span class="punct">(</span><span class="ident">string</span><span class="punct">)</span>
    <span class="keyword">return</span> <span class="constant">true</span> <span class="keyword">if</span> <span class="ident">string</span> <span class="punct">==</span> <span class="constant">true</span> <span class="punct">||</span> <span class="ident">string</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">^true$</span><span class="punct">/</span><span class="ident">i</span>
    <span class="keyword">return</span> <span class="constant">false</span> <span class="keyword">if</span> <span class="ident">string</span> <span class="punct">==</span> <span class="constant">false</span> <span class="punct">||</span> <span class="ident">string</span><span class="punct">.</span><span class="ident">nil?</span> <span class="punct">||</span> <span class="ident">string</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">^false$</span><span class="punct">/</span><span class="ident">i</span>
    <span class="keyword">raise</span> <span class="constant">ArgumentError</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(&quot;</span><span class="string">invalid value for Boolean: <span class="escape">\&quot;</span><span class="expr">#{string}</span><span class="escape">\&quot;</span></span><span class="punct">&quot;)</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="ident">require</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">dirname</span><span class="punct">(</span><span class="constant">__FILE__</span><span class="punct">)</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">/../test_helper</span><span class="punct">'</span>

<span class="keyword">class </span><span class="class">KernelTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>

  <span class="keyword">def </span><span class="method">test_should_return_true</span>
    <span class="ident">assert_equal</span> <span class="constant">true</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">true</span><span class="punct">')</span>
    <span class="ident">assert_equal</span> <span class="constant">true</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">TrUe</span><span class="punct">')</span>
    <span class="ident">assert_equal</span> <span class="constant">true</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">(</span><span class="constant">true</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_return_false</span>
    <span class="ident">assert_equal</span> <span class="constant">false</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">(</span><span class="constant">nil</span><span class="punct">)</span>
    <span class="ident">assert_equal</span> <span class="constant">false</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">false</span><span class="punct">')</span>
    <span class="ident">assert_equal</span> <span class="constant">false</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">FaLsE</span><span class="punct">')</span>
    <span class="ident">assert_equal</span> <span class="constant">false</span><span class="punct">,</span> <span class="constant">Boolean</span><span class="punct">(</span><span class="constant">false</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_raise_exception</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">true </span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string"> true</span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string"> true </span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">false </span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string"> false</span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string"> false </span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">('</span><span class="string">BLAH</span><span class="punct">')</span> <span class="punct">}</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">ArgumentError</span><span class="punct">)</span> <span class="punct">{</span> <span class="constant">Boolean</span><span class="punct">(</span><span class="number">1</span><span class="punct">)</span> <span class="punct">}</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/10/18/inactive-keywords-too-high-mincpc-when-using-google-adwords-api">Inactive keywords (too high minCpc) when using Google Adwords Api</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 18 Oct 2006 07:40:00">
                    Wed, 18 Oct 2006 07:40:00
                  </span>
                </p>

                <h3>Short version</h3>


	<p><strong><span class="caps">ALWAYS</span></strong> create adverts (creatives) <strong>before</strong> keywords when setting up an ad group using the Adwords Api</p>


	<h3>Longer version</h3>


	<p>Our first use of the adwords api was to create around 850 ad groups, each with three text ads and one keyword.  Although the creation seemed to go to plan, a quick inspection in the adwords interface revealed that all of our ads were marked as inactive, with most of our keywords having a minimum bid of 2.50!</p>


	<p>Adding the exact same keywords and text ads manually resulted in active keywords, so we knew there was nothing wrong with our content.</p>


	<p>A few searches on google didn&#8217;t yield any relevant results, but searching the <a href="http://groups.google.com/group/adwords-api">adwords api google group</a> seemed to reveal other people having the same problem.  The solution was (and is) simple &#8211; ensure that you create your keywords <strong>after</strong> you&#8217;ve created your ad content.  Indeed, it is impossible to create them in any other order from within the adwords interface itself.</p>


	<p>Right now this is just a pain, as it needlessly wastes api quota &#8211; about 700,000 in our case.  Come  <a href="http://adwordsapi.blogspot.com/2006/09/deadline-for-registration-and-billing.html">November 1st</a> this will cost you hard cash &#8211; around 80.00 &#8211; 90 for our 700,000&#8217;ish.</p>


	<p>I&#8217;m hoping google will change their api to warn you when keywords are created before creatives, or, at the very least, make it extremely clear in the docs that there is an order in which the two should be created.  In the meantime, maybe this will help people searching google for an answer to the same problem.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/adwords" rel="tag">adwords</a>, 
                    
                      <a href="/articles/tag/api" rel="tag">api</a>, 
                    
                      <a href="/articles/tag/google" rel="tag">google</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/10/14/some-useful-assertions-maybe">Some useful assertions, maybe</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 14 Oct 2006 10:27:00">
                    Sat, 14 Oct 2006 10:27:00
                  </span>
                </p>

                <p>The first is to ensure two arrays contain the same elements not necessarily in the same order.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">test/unit</span><span class="punct">'</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">set</span><span class="punct">'</span>
<span class="keyword">module </span><span class="module">AssertEqualArray</span>

  <span class="keyword">def </span><span class="method">assert_equal_array</span><span class="punct">(</span><span class="ident">array_1</span><span class="punct">,</span> <span class="ident">array_2</span><span class="punct">)</span>
    <span class="ident">assert_equal</span> <span class="ident">array_1</span><span class="punct">.</span><span class="ident">size</span><span class="punct">,</span> <span class="ident">array_2</span><span class="punct">.</span><span class="ident">size</span><span class="punct">,</span> <span class="punct">&quot;</span><span class="string">Arrays must be of the same size to be equal</span><span class="punct">&quot;</span>
    <span class="ident">assert_equal</span> <span class="ident">array_1</span><span class="punct">.</span><span class="ident">to_set</span><span class="punct">,</span> <span class="ident">array_2</span><span class="punct">.</span><span class="ident">to_set</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">Test::Unit::TestCase</span>
  <span class="ident">include</span> <span class="constant">AssertEqualArray</span>
<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">MyTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>

  <span class="keyword">def </span><span class="method">test_should_assert_equal_arrays</span>
    <span class="ident">assert_equal_array</span> <span class="punct">[</span><span class="number">1</span><span class="punct">,</span> <span class="number">2</span><span class="punct">,</span> <span class="number">3</span><span class="punct">],</span> <span class="punct">[</span><span class="number">2</span><span class="punct">,</span> <span class="number">1</span><span class="punct">,</span> <span class="number">3</span><span class="punct">]</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

	<p>The second is to test for generated warnings.  In my <a href="http://blog.seagul.co.uk/articles/2006/10/06/recording-daily-spending-with-a-ruby-dsl">current project</a> app, I use method_missing and wanted to warn the user if the unknown message looks like it&#8217;s supposed to be a payment mechanism&#8230;</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">day</span> <span class="punct">'</span><span class="string">25-oct-2006</span><span class="punct">'</span> <span class="keyword">do</span>
  <span class="ident">cash</span> <span class="number">30.29</span><span class="punct">,</span> <span class="ident">beer</span>
<span class="keyword">end</span>

<span class="comment"># Results in NoMethodError and, more importantly, this friendly warning..</span>
<span class="comment"># Maybe you expected 'cash' to be a payment mechanism?</span>
<span class="comment"># Cool huh?</span></code></pre></div>

	<p>Anyway, I wanted a way to test that the warning was being generated and came up with another assertion&#8230;</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">test/unit</span><span class="punct">'</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">stringio</span><span class="punct">'</span>
<span class="keyword">module </span><span class="module">AssertWarning</span>

  <span class="keyword">def </span><span class="method">assert_warning</span><span class="punct">(</span><span class="ident">expected_warning</span><span class="punct">,</span> <span class="punct">&amp;</span><span class="ident">blk</span><span class="punct">)</span>
    <span class="ident">original_stderr</span> <span class="punct">=</span> <span class="global">$stderr</span>
    <span class="global">$stderr</span> <span class="punct">=</span> <span class="ident">stderr</span> <span class="punct">=</span> <span class="constant">StringIO</span><span class="punct">.</span><span class="ident">new</span>
    <span class="keyword">yield</span>
    <span class="ident">assert_equal</span> <span class="ident">expected_warning</span><span class="punct">,</span> <span class="ident">stderr</span><span class="punct">.</span><span class="ident">string</span><span class="punct">.</span><span class="ident">chomp</span>
  <span class="keyword">ensure</span>
    <span class="global">$stderr</span> <span class="punct">=</span> <span class="ident">original_stderr</span>
  <span class="keyword">end</span>

<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">Test::Unit::TestCase</span>
  <span class="ident">include</span> <span class="constant">AssertWarning</span>
<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">MyTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>

  <span class="keyword">def </span><span class="method">test_should_assert_warning</span>
    <span class="ident">assert_warning</span><span class="punct">('</span><span class="string">this is a warning</span><span class="punct">')</span> <span class="punct">{</span> <span class="constant">Kernel</span><span class="punct">::</span><span class="ident">warn</span><span class="punct">('</span><span class="string">this is a warning</span><span class="punct">')</span> <span class="punct">}</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/assertions" rel="tag">assertions</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/test" rel="tag">test</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/10/06/recording-daily-spending-with-a-ruby-dsl">Recording daily spending with a Ruby Dsl</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 06 Oct 2006 09:19:00">
                    Fri, 06 Oct 2006 09:19:00
                  </span>
                </p>

                <p>I&#8217;m very very very bad with money.  Don&#8217;t get me wrong, I&#8217;m very good at <del>spending</del> wasting money, just bad at all <a href="http://en.wikipedia.org/wiki/Savings">the</a> <a href="http://en.wikipedia.org/wiki/Investing">boring</a> <a href="http://en.wikipedia.org/wiki/Pension">stuff</a>.</p>


	<p>The main part of my problem is that I never know how much I have and therefore don&#8217;t know when to stop spending.  This is down to laziness.  It takes time to check balances at a cash point or via my bank&#8217;s website.  I feel that this time can be better spent withdrawing the cash and wandering to the pub.</p>


	<p>Anyhoo.  What I really need is a something that illustrates (preferably with big colourful graphs) the amount going out vs the amount coming in.  This needs to be as un-intrusive as possible or I&#8217;m not going to use it.  I&#8217;d also kinda like to see what sort of things I&#8217;m spending on, so that I can maybe shock myself into stopping.  So, I need a record of what I spend my money on.  Enter&#8230; The little dsl to do just that.</p>


<div class="typocode"><pre><code class="typocode_default">payment_mechanisms :cash, :cheque

day '6-oct-2006' do
  cheque 9.99, lunch, 'expensivo restaurant', burger
  cash 4.00, 'return ticket', train
  cash 1.00, 'mars bar', coke
end</code></pre></div>

	<p>This basically records when and how much I spent, what I spent it on and how I paid for it.  It does nothing more than record at present (and offer some basic addition), but I&#8217;ve got some more ideas.</p>


	<p>There&#8217;s also a budgeting counterpart.  The idea being that my colourful graphs can show (very clearly) when I go over budget for a given day/week/month etc.</p>


<div class="typocode"><pre><code class="typocode_default">weekly do
  outgoing 18.00, lunch
  outgoing 40.00, 'train travel'
end

monthly do
  income 1_000_000, 'wages (not really my monthly wage)'
  outgoing 500_000, tax
end

yearly do
  outgoing 25.00, 'flickr subscription'
end</code></pre></div>

	<p>That&#8217;s about all I have at the moment.  Unfortunately, I&#8217;m already getting a bit bored with this project so this may be the last of it and I&#8217;ll continue spending over my limits.  Or, I&#8217;ll get those colourful graphs added and it&#8217;ll be heralded as the best budgeting app in the world ever<sup><a href="#fn1">1</a></sup>.</p>


	<p id="fn1"><sup>1</sup> This reminds me of the &#8216;best [dance|rock|urban|insert music genre here] album in the world ever&#8230;&#8217; type compilations, of which <a href="http://www.amazon.co.uk/Worst-Album-World-Ever-Ever-Shirehorses/dp/B000024V87">this</a> is undoubtedly the best.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/dsl" rel="tag">dsl</a>, 
                    
                      <a href="/articles/tag/finance" rel="tag">finance</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/09/30/bye-bye-feedshow">Bye bye feedshow...</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 30 Sep 2006 06:51:00">
                    Sat, 30 Sep 2006 06:51:00
                  </span>
                </p>

                <p>... hello <a href="http://www.techcrunch.com/2006/09/28/google-reader-steps-it-up-with-new-version/">revamped</a> <a href="http://reader.google.com">google reader</a></p>

                
              
                <h2>
                  <a href="/articles/2006/09/22/the-best-property-search-website">The best property search website</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 22 Sep 2006 11:16:00">
                    Fri, 22 Sep 2006 11:16:00
                  </span>
                </p>

                <p>The majority of estate agent websites are crap.  Fact<sup><a href="#fn1">1</a></sup>.</p>


	<p><a href="http://www.nestoria.co.uk">Nestoria</a> is not crap.  Fact<sup><a href="#fn1">1</a></sup>.</p>


	<p id="fn1"><sup>1</sup>  <strong>fact</strong> <em>-noun</em> &#8211; the personal opinion of chris</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/fact" rel="tag">fact</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/09/22/testing-against-the-garbage-collection-clock-or-dont-create-your-test-cases-as-anonymous-classes">Testing against the (Garbage Collection) Clock, or, Don't create your Test Cases as anonymous classes</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 22 Sep 2006 10:43:00">
                    Fri, 22 Sep 2006 10:43:00
                  </span>
                </p>

                <p>I <a href="http://blog.seagul.co.uk/articles/2006/07/17/some-realisations-about-testing">wrote</a> a while ago about how I&#8217;d started creating my test cases as anonymous classes.</p>


	<p>I continued this practice until I was slapped in the face by my own stoopidity yesterday.  We were seeing a problem where tests were failing individually but appearing to run fine in rake.</p>


	<p><a href="http://blog.floehopper.org">James</a> was looking into it&#8230;</p>


<pre>
James: it seems like the ones defined by Class.new(Test::Unit::TestCase) aren't always being found in the ObjectSpace
James: but I can't quite work out why
James: i'm tempted to name them all as defined classes
Chris: oh ok
Chris: go for it
James: i'm pretty sure that works ok
Chris: interesting
James: only difference i can think of is that if the file is loaded twice you will create two instances of the anonymous class
James: whereas with the named class it will just reopen same class
Chris: why would that be a problem?
James: but it doens't look like its being loaded twice anyway
James: dunno
James: its the only difference i can think of, but it doesn't explain anything
James: can you think of any other differences
Chris: so if you create named classes for the testcases in p_l_i_test does it then fail in rake?
James: yup - and i've seen the problem in other tests where anonymous tests are defined
James: so there are quite a few tests that haven't been running in rake
Chris: bugger
Chris: i think ben just explained the problem
James: yeah?
Chris: as the classes aren't assigned to constants they can be garbage collected
Chris: oops
James: aha
Chris: no more anonymous test classes for christopher
James: that explains - why they were in the ObjectSpace one minute and not the next
</pre>

	<p>Note that p_l_i_test mentioned above is just a shorthand for one of our tests that was failing individually but &#8216;running&#8217; (or as we now know, not running) from rake.</p>


	<p>So, although you get a little added excitement to your testing (&#8220;Will this test class run before it gets garbage collected???&#8221;), it&#8217;s probably a lot safer to not use anonymous classes when testing.</p>


	<p>James has just informed me that we gained about 230 tests in rake by naming all of our test cases&#8230;</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/09/18/unified-method_exists-method-for-ruby">Unified method_exists method for ruby</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 18 Sep 2006 22:59:00">
                    Mon, 18 Sep 2006 22:59:00
                  </span>
                </p>

                <p>There are loads of different ways to check whether an object (class or instance) contains a given method.</p>


	<p>In fact, there are so many different ways that I spent some time working out what was what.</p>


	<p>I started out testing each of the relevant Module methods on both a class and instance.  This was followed up by testing each of the relevant Object methods on both a class and instance.  The full test suite is <a href="http://blog.seagul.co.uk/pages/20060918_testing_method_responses_full">here</a>.</p>


	<p>I summarised the results into a more compact test suite <a href="http://blog.seagul.co.uk/pages/20060918_testing_method_responses_compact">here</a>.</p>


	<p>I think I&#8217;m correct in stating that there&#8217;s no one way to check for the existence of a method (be it public, protected or private) on a class.  However, the test results make it slightly easier to scan and create such a method &#8211; <a href="http://blog.seagul.co.uk/pages/20060918_testing_class_method_exists">three variants</a> none-the-less.</p>


	<p>The same statement goes for uniformly determining the existence of a method on an instance.  Once again the tests helped derive the three implementations <a href="http://blog.seagul.co.uk/pages/20060918_testing_instance_method_exists">here</a>.</p>


	<p>Combining these two imlpementations provides us with a uniform method to determine whether the receiver contains a method represented by <em>method_sym</em>.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">Object</span>
  <span class="keyword">def </span><span class="method">method_exists?</span><span class="punct">(</span><span class="ident">method_sym</span><span class="punct">)</span>
    <span class="ident">methods</span> <span class="punct">=</span> <span class="ident">public_methods</span> <span class="punct">+</span> <span class="ident">protected_methods</span> <span class="punct">+</span> <span class="ident">private_methods</span>
    <span class="ident">methods</span><span class="punct">.</span><span class="ident">include?</span><span class="punct">(</span><span class="ident">method_sym</span><span class="punct">.</span><span class="ident">to_s</span><span class="punct">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="keyword">class </span><span class="class">Class</span>
  <span class="keyword">def </span><span class="method">method_exists?</span><span class="punct">(</span><span class="ident">method_sym</span><span class="punct">)</span>
    <span class="ident">methods</span> <span class="punct">=</span> <span class="ident">public_instance_methods</span> <span class="punct">+</span> <span class="ident">protected_instance_methods</span> <span class="punct">+</span> <span class="ident">private_instance_methods</span>
    <span class="ident">methods</span><span class="punct">.</span><span class="ident">include?</span><span class="punct">(</span><span class="ident">method_sym</span><span class="punct">.</span><span class="ident">to_s</span><span class="punct">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>

<span class="keyword">class </span><span class="class">Foo</span>
  <span class="keyword">def </span><span class="method">foo</span><span class="punct">;</span> <span class="keyword">end</span><span class="punct">;</span> <span class="ident">public</span> <span class="symbol">:foo</span>
  <span class="keyword">def </span><span class="method">bar</span><span class="punct">;</span> <span class="keyword">end</span><span class="punct">;</span> <span class="ident">protected</span> <span class="symbol">:bar</span>
  <span class="keyword">def </span><span class="method">baz</span><span class="punct">;</span> <span class="keyword">end</span><span class="punct">;</span> <span class="ident">private</span> <span class="symbol">:baz</span>
<span class="keyword">end</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">test/unit</span><span class="punct">'</span>

<span class="constant">Class</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span><span class="punct">)</span> <span class="keyword">do</span>

  <span class="keyword">def </span><span class="method">assert_not</span><span class="punct">(</span><span class="ident">expr</span><span class="punct">)</span>
    <span class="ident">assert</span> <span class="punct">!</span> <span class="ident">expr</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">assert_method_exists_is_working</span><span class="punct">(</span><span class="ident">receiver</span><span class="punct">)</span>
    <span class="punct">[</span><span class="symbol">:foo</span><span class="punct">,</span> <span class="symbol">:bar</span><span class="punct">,</span> <span class="symbol">:baz</span><span class="punct">].</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">sym</span><span class="punct">|</span>
      <span class="ident">assert</span> <span class="ident">receiver</span><span class="punct">.</span><span class="ident">method_exists?</span><span class="punct">(</span><span class="ident">sym</span><span class="punct">)</span>
      <span class="ident">assert</span> <span class="ident">receiver</span><span class="punct">.</span><span class="ident">method_exists?</span><span class="punct">(</span><span class="ident">sym</span><span class="punct">.</span><span class="ident">to_s</span><span class="punct">)</span>
    <span class="keyword">end</span>
    <span class="ident">assert_not</span> <span class="ident">receiver</span><span class="punct">.</span><span class="ident">method_exists?</span><span class="punct">(</span><span class="symbol">:made_up_method</span><span class="punct">)</span>
    <span class="ident">assert_not</span> <span class="ident">receiver</span><span class="punct">.</span><span class="ident">method_exists?</span><span class="punct">('</span><span class="string">made_up_method</span><span class="punct">')</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_class</span>
    <span class="ident">assert_method_exists_is_working</span><span class="punct">(</span><span class="constant">Foo</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_instance</span>
    <span class="ident">assert_method_exists_is_working</span><span class="punct">(</span><span class="constant">Foo</span><span class="punct">.</span><span class="ident">new</span><span class="punct">)</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

	<p>What&#8217;s the point you ask?  I genuinely have no idea.  I&#8217;m sure there was one when I started but then my compulsiveness took over and I had to finish for no other reason than to finish.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/09/18/gdisk-very-cheap-free-online-storage">gDisk - very cheap (free) online storage</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 18 Sep 2006 20:17:00">
                    Mon, 18 Sep 2006 20:17:00
                  </span>
                </p>

                <p>I&#8217;ve used <a href="http://gdisk.sourceforge.net/">this</a> for a while but haven&#8217;t got round to mentioning it.</p>


	<p>Basically, it uses a <a href="http://mail.google.com">gmail</a> account (curently offering around 2.7GB space) as online storage, accessed seamlessly from this app.  Mac Os X only I&#8217;m afraid although I&#8217;m sure I&#8217;ve heard of Windows alternatives.</p>


	<p>I&#8217;m not sure if gmail is still invite only, but if it is, and if someone reading doesn&#8217;t have a gmail account, let me know as I have plenty of invites.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/software" rel="tag">software</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/09/11/whats-the-time-google">What's the time google?</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 11 Sep 2006 09:17:00">
                    Mon, 11 Sep 2006 09:17:00
                  </span>
                </p>

                <p>From this <a href="http://dmiessler.com/archives/910">article</a> (via <a href="http://www.lifehacker.com/software/google/google-school--get-the-local-time-for-a-location-199286.php">lifehacker</a>), we can ask google for the time.</p>


	<p>time london</p>


	<p>London, United Kingdom  Current local time: 9:18 AM on Monday, September 11<br/>
According to http://www.google.com</p>


	<p>That&#8217;s pretty cool.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/google" rel="tag">google</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/09/09/changing-irb-context">Changing Irb context</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 09 Sep 2006 12:16:00">
                    Sat, 09 Sep 2006 12:16:00
                  </span>
                </p>

                <p>I picked up on this yesterday and now cannot find the article (it was something to do with manipulating a rails app from the console).  Sorry.</p>


<div class="typocode"><pre><code class="typocode_default">irb(main):001:0&gt; class Foo
irb(main):002:1&gt; private
irb(main):003:1&gt; def bar
irb(main):004:2&gt; 'bar'
irb(main):005:2&gt; end
irb(main):006:1&gt; end
=&gt; nil
irb(main):007:0&gt; Foo.new.bar
NoMethodError: private method `bar' called for #&lt;Foo:0x358304&gt;
        from (irb):7
        from :0
irb(main):009:0&gt; irb Foo.new # IMPORTANT BIT
irb#1(#&lt;Foo:0x31c5fc&gt;):001:0&gt; bar
=&gt; &quot;bar&quot;</code></pre></div>

	<p>Although cool, I can&#8217;t think of any situations where this would have been useful.  Ho hum.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/irb" rel="tag">irb</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/09/09/in-memory-ar-object-for-testing">In memory AR object for testing</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 09 Sep 2006 12:03:00">
                    Sat, 09 Sep 2006 12:03:00
                  </span>
                </p>

                <p>I&#8217;ve <a href="http://blog.seagul.co.uk/articles/2006/07/12/using-in-memory-active-record-objects-with-associations-for-testing">previously written</a> about using in memory active record objects for testing.</p>


	<p>In doing so recently, I&#8217;ve found it necessary to define the id of the in memory object.  By default this is obviously nil as it has not been persisted.  In addition, it is not possible to set it during normal object construction.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">person</span> <span class="punct">=</span> <span class="constant">Person</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="symbol">:id</span> <span class="punct">=&gt;</span> <span class="number">1</span><span class="punct">)</span>
<span class="ident">p</span> <span class="ident">person</span><span class="punct">.</span><span class="ident">id</span>
<span class="comment">#=&gt; nil</span></code></pre></div>

	<p>However, we can give the person constructor a block, setting the id just after creation.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">person</span> <span class="punct">=</span> <span class="constant">Person</span><span class="punct">.</span><span class="ident">new</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">p</span><span class="punct">|</span> <span class="ident">p</span><span class="punct">.</span><span class="ident">id</span> <span class="punct">=</span> <span class="number">1</span> <span class="punct">}</span>
<span class="ident">p</span> <span class="ident">person</span><span class="punct">.</span><span class="ident">id</span>
<span class="comment">#=&gt; 1</span></code></pre></div>

	<p>Cool.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/09/09/recommended-web-host">Recommended web host</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 09 Sep 2006 11:32:00">
                    Sat, 09 Sep 2006 11:32:00
                  </span>
                </p>

                <p>I can&#8217;t recommend <a href="http://www.asmallorange.com">A Small Orange</a> enough.  They offer very competitive shared hosting and don&#8217;t charge for &#8220;upgrades&#8221; like the majority of hosts.  From their site..</p>


	<p>Many hosts put artificial limits on what you can do in order to force you to upgrade your account, just so you will buy that one extra MySQL database or extra email account you need. At A Small Orange, we don&#8217;t believe in artificial limitations so we offer the following unlimited features on all our hosting accounts:</p>


	<ul>
	<li>Unlimited <span class="caps">POP3</span>/IMAP Mail Accounts</li>
		<li>Unlimited MySQL Databases</li>
		<li>Unlimited Mailing Lists</li>
		<li>Unlimited Email Forwarders</li>
		<li>Unlimited Subdomains</li>
		<li>Unlimited Parked and Addon Domains</li>
		<li>Unlimited <span class="caps">FTP</span> Accounts</li>
	</ul>


	<p>I have been offering web and email hosting for a couple of local firms (harking back to me self-[un]employed days).  I wanted to get them moved to someone else (to relieve me of the burden) but felt responsible for getting them a good deal.  They only have small static sites so I was reluctant to pay for expensive hosting that offered unnecessary features.  I found <a href="http://www.dataflame.co.uk">dataflame</a> to be relatively cheap.  Unfortunately the &#8216;cheapness&#8217; soon disappears once we look at &#8216;upgrading&#8217; our account with such &#8216;features&#8217; as parked domains.  In fairness, most hosts seem to charge for these automated extras, making me very happy to discover <span class="caps">ASO</span>.</p>


	<p>I&#8217;ve moved the accounts over to <span class="caps">ASO</span> and have had no problems to date.</p>


	<p>I actually had reason to contact <span class="caps">ASO</span> yesterday (enable ssh access and one other matter).  Ssh access was configured within five minutes of my sending the email.  The other matter was resolved within one hour.  That&#8217;s some good supportin&#8217; they got goin&#8217; on.</p>


	<p>They also boast <a href="http://www.rubyonrails.com">rails</a> support but I haven&#8217;t got round to testing this yet.</p>


	<p>In fairness, I actually moved hosting for one of the firms to <a href="http://www.bluehost.com">bluehost</a> originally.  These guys also offer great rates and features (not quite as great as <span class="caps">ASO</span>).  We just had one problem &#8211; there are consistent network failures between us (at least parts of the UK) and them (somewhere in the States).  They can see the problem but as it lies with one of their upstream providers apparently there is not much they can do about it.  Hmmm.</p>


	<p>That&#8217;s enough praising for now.  Go <span class="caps">ASO</span>.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/hosting" rel="tag">hosting</a>, 
                    
                      <a href="/articles/tag/praise" rel="tag">praise</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/08/22/textmate-environment-and-ruby-again">Textmate environment and ruby (again)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 22 Aug 2006 23:53:00">
                    Tue, 22 Aug 2006 23:53:00
                  </span>
                </p>

                <p>I&#8217;ve recently upgraded the version of ruby on my machine and came up against problems similar to <a href="http://blog.seagul.co.uk/articles/2006/07/28/textmate-and-env-ruby-no-such-file-or-directory">this</a>.  The problem previously was that <a href="http://www.macromates.com">textmate</a> wasn&#8217;t finding <a href="http://www.ruby-lang.org">ruby</a> at all.  This time, textmate was finding the wrong version of ruby.</p>


	<p>I found the following script useful in determining exactly which ruby binary textmate was using.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment">#!/usr/bin/env ruby</span>

<span class="ident">require</span> <span class="punct">'</span><span class="string">rbconfig</span><span class="punct">'</span>
<span class="ident">puts</span> <span class="constant">Config</span><span class="punct">::</span><span class="constant">CONFIG</span><span class="punct">['</span><span class="string">bindir</span><span class="punct">']</span></code></pre></div>

	<p>Simply paste that into a textmate document, select it and hit Ctrl-r.  The path of the ruby binary should print right there in the window.</p>


	<p>To see far more info than you&#8217;ll ever likely need, replace the line starting <code>puts</code> above, with the following..</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Config</span><span class="punct">::</span><span class="constant">CONFIG</span><span class="punct">.</span><span class="ident">sort</span><span class="punct">.</span><span class="ident">each</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">key</span><span class="punct">,</span> <span class="ident">value</span><span class="punct">|</span>
    <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string"><span class="expr">#{key}</span> = <span class="expr">#{value}</span></span><span class="punct">&quot;</span>
<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/environment" rel="tag">environment</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/textmate" rel="tag">textmate</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/08/22/rails-leaking-some-strings-in-development">Rails leaking some strings in development</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 22 Aug 2006 10:47:00">
                    Tue, 22 Aug 2006 10:47:00
                  </span>
                </p>

                <p>I spent some time this morning checking out <a href="http://scottstuff.net/blog/">Scott Laird&#8217;s</a> <a href="http://scottstuff.net/blog/articles/2006/08/17/memory-leak-profiling-with-rails">memory profiler</a> against a fresh rails app.</p>


	<p>I was suprised to see that around 110 strings were being leaked on each request.  I was incredibly surprised when I used the string_debug option (to the memory profiler) to generate logs of strings living in ObjectSpace.  There were strings appearing that I <em>knew</em> were not in my new rails app anywhere.</p>


	<p>After grepping my working directory for some of these strings (and not coming up with anything), <a href="http://blog.floehopper.org">James</a> suggested that the strings could be in my irb history.  Although it wasn&#8217;t immediately obvious how they were appearing, the strings were indeed in my history (just over 100 lines worth.)</p>


	<p>A little inspection and the culprit was found.  The <a href="http://api.rubyonrails.com/classes/Breakpoint.html">rails breakpoint library</a> requires irb, which loads the irb_history.</p>


	<p>In summary: the contents of irb_history are loaded into object space on each request made to your rails app, while in development.  These strings do not appear to get garbage collected.  The problem does not affect apps running in production as the breakpoint library is not loaded in that environment.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/memoryleak" rel="tag">memoryleak</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/08/22/feed-reading-feature-requests">Feed reading feature requests</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 22 Aug 2006 08:03:00">
                    Tue, 22 Aug 2006 08:03:00
                  </span>
                </p>

                <p>A bit of an unordered list of features I&#8217;d like to see in a feed reader.  It&#8217;s very possible these exist in some readers that I&#8217;m not aware of (I&#8217;ve moved from <a href="http://www.sharpreader.net/">desktop app on windows</a> through <a href="http://bloglines.com/">bloglines</a> and <a href="http://www.rojo.com">rojo</a> to <a href="http://www.feedshow.com">feedshow</a>).</p>


	<ul>
	<li>Comment from within the reader.  This would then automatically subscribe to a feed of the comments so that I could poll the updates.</li>
	</ul>


	<ul>
	<li>Notify me when feeds haven&#8217;t been accessible for a while.  Maybe the address has changed or the reader cannot interpret the feed correctly; either way, I&#8217;d like to know so that I can make an informed decision about what to do.</li>
	</ul>


	<ul>
	<li>When a page offers multiple feed formats, I don&#8217;t want to be asked what format to subscribe to.  The program should know the format it supports best and choose that.  As I type this, I&#8217;m thinking that this is more difficult if there is a choice between full and summary content.</li>
	</ul>


	<ul>
	<li>If an existing article is &#8216;refreshed&#8217; then diff it.  If it hasn&#8217;t changed then I don&#8217;t want to see it.  If it has changed, then highlight the changes for me.</li>
	</ul>


	<ul>
	<li>Show html in articles sensibly (rojo seemed to fail miserably on this front).</li>
	</ul>


	<ul>
	<li>Host a &#8216;live&#8217; (i.e. dynamically generated copy of my feeds in opml) &#8211; I can&#8217;t think of any reason to have to import/export these.</li>
	</ul>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/apps" rel="tag">apps</a>, 
                    
                      <a href="/articles/tag/feed" rel="tag">feed</a>, 
                    
                      <a href="/articles/tag/reading" rel="tag">reading</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/08/21/i-hope-i-didnt-break-rubyforge">I hope I didn't break rubyforge...</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 21 Aug 2006 23:30:00">
                    Mon, 21 Aug 2006 23:30:00
                  </span>
                </p>

                <p>A couple of days ago I was playing around with <a href="http://search.cpan.org/~clkao/SVN-Mirror-0.68/lib/SVN/Mirror.pm"><span class="caps">SVN</span>::Mirror</a>, trying to remove some <a href="http://wiki.rubyonrails.org/rails/pages/Plugins">dependencies</a> on third party repositories not in our control.</p>


	<p>All was going well until I tried to mirror a <a href="http://rubyforge.org/projects/mocha/">project</a> hosted on rubyforge.  On initialising the mirror, I kept receiving the error &#8220;source url not under source root&#8221; from line 72 in Ra.pm.</p>


	<p>After some very careful debugging (yeah, like I know anything about perl &#8211; <code>print "1";</code> was about the extent of it) of that perl file; I noticed that the $source_root variable didn&#8217;t contain the double slash<sup><a href="#fn1">1</a></sup>.  This causes a problem for the line <code>if substr($path, 0, length($source_root), '') ne $source_root;</code> as at this point, $path does contain the double slash.</p>


	<p>The value of $source_root is returned from a call to RA-&gt;get_repos_root (Subversion Repository Access code).  So; it would seem that the url was being normalised somewhere in the bowels of <a href="http://subversion.tigris.org">Subversion</a>.</p>


	<p>This was kinda confirmed by testing the svn client (which uses the code in the RA module just like <span class="caps">SVN</span>::Mirror) with urls containing additional slashes.  The url was always resolved and svn info would always show the normalised variant.  It was additionally(ish) tested by using the <a href="http://www.ruby-lang.org">Ruby</a> <a href="http://svn.collab.net/viewvc/svn/trunk/subversion/bindings/swig/ruby/">bindings</a> (which, as an aside, contain just about the most difficult to read Ruby code I&#8217;ve ever come across!)</p>


	<p>I would love to have followed the actual subversion c code to find the normalisation routine but I&#8217;m sadly not clever enough; so my findings had to suffice.</p>


	<p>Anyhoo, the outcome of the story is that I emailed Tom Copeland of rubyforge fame to ask about the deal with the double slashes.  Turns out that it was probably just a <a href="http://gforge.org/">gforge</a> default thing and Tom went ahead and promptly changed it.  I suddenly got very nervous that lots of arms would be thrown up with cries of &#8220;Who broke rubyforge?&#8221;, but so far it would appears to be ok.  Phew.</p>


	<p id="fn1"><sup>1</sup> Not sure if anyone else had really noticed but the svn repositories on rubyforge used to contain a double slash between the domain and var path (i.e. rubyforge.org//var).</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/perl" rel="tag">perl</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/rubyforge" rel="tag">rubyforge</a>, 
                    
                      <a href="/articles/tag/svm" rel="tag">svm</a>, 
                    
                      <a href="/articles/tag/svn" rel="tag">svn</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/08/17/i-guess-thats-one-way-to-do-it">I guess that's one way to do it...</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 17 Aug 2006 08:08:00">
                    Thu, 17 Aug 2006 08:08:00
                  </span>
                </p>

                <p>We&#8217;re not <em>quite</em> at this stage yet&#8230;</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">ActiveRecord::ConnectionAdapters::MysqlAdapter</span>
  <span class="keyword">alias</span> <span class="symbol">:execute_before_test_hijack</span> <span class="symbol">:execute</span>
  <span class="keyword">def </span><span class="method">execute</span><span class="punct">(*</span><span class="ident">args</span><span class="punct">)</span>
    <span class="keyword">unless</span> <span class="ident">args</span><span class="punct">.</span><span class="ident">first</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">^SHOW FIELDS FROM</span><span class="punct">/</span> <span class="punct">||</span> <span class="punct">%w[</span><span class="string">BEGIN COMMIT ROLLBACK END</span><span class="punct">].</span><span class="ident">include?</span><span class="punct">(</span><span class="ident">args</span><span class="punct">.</span><span class="ident">first</span><span class="punct">)</span>
      <span class="keyword">raise</span> <span class="punct">&quot;</span><span class="string">You know you're not allowed to use the database in your tests...</span><span class="punct">&quot;</span> <span class="comment"># We could be more gentle with a warn</span>
    <span class="keyword">end</span>
    <span class="ident">execute_before_unit_test_hijack</span><span class="punct">(*</span><span class="ident">args</span><span class="punct">)</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/database" rel="tag">database</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/08/14/tickling-link_to-into-submission">Tickling link_to into submission</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 14 Aug 2006 23:10:00">
                    Mon, 14 Aug 2006 23:10:00
                  </span>
                </p>

                <p>What a crappy title.  Ho hum.</p>


	<p>This bit explains the itch I had.  Skip over it if you like.</p>


	<p>I recently finished re-structuring some of the code at <a href="http://www.reevoo.com">work</a>, in which I namespaced all of the admin type controllers.  At the same time, I attempted to split some of the larger, confused (about their responsibilities) controllers into smaller chunks.  This all seems to have worked quite well, but we&#8217;ve ended up with some naff (I haven&#8217;t used that word in ages) action names.</p>


	<p>I like, where possible, to follow the scaffold naming convention (list, show, new, create, edit, update and destroy); and so went ahead and started changing things.  I was writing my tests like mum always said I should<sup><a href="#fn1">1</a></sup> when I realised that there was a bit missing (uh oh).  You see, I was ensuring that my controllers responded to certain actions; and I was also ensuring that my views had links to certain controllers and actions.  The missing link was a check as to whether the links in my views went to valid controller actions.  I could, for example, have been testing for a link to /foo/edit in my view but for an edit_foo action in my foo_controller test.  Both tests would pass, but the application would still be broken.  Not cool.  We do actually have <a href="http://openqa.org/selenium">something</a> in place to perform these tests but I&#8217;m still a bit scared of selenium and don&#8217;t use it as much as I should.</p>


	<p>Anyway, i started thinking about bending the <a href="http://api.rubyonrails.com/classes/ActionView/Helpers/UrlHelper.html#M000378">link_to</a> helper to my will.  I figured that the little fella was a good candidate to not only give me a perfectly formed chunk of html goodness; but to also tell me whether the said chunk of html goodness was actually going to work (i.e. whether my app responded to the generated url).  Cool idea huh.</p>


	<p>I&#8217;m getting tired and a little bored now so I&#8217;ll wrap this post up.  I&#8217;ve created a <a href="http://dev.seagul.co.uk/repository/browse/plugins/action_view_helper_url_helper">plugin</a> (svn co svn://dev.seagul.co.uk/plugins/action_view_helper_url_helper) that replaces the link_to method to add a class attribute (invalid_href_target or valid_href_target) to the generated anchor tag.  You could then use the assert_no_broken_links assertion to ensure there are no anchors with a class of invalid_href_target in your views; and/or you could style it (see resource/style.css as an example) so that you can see any broken links at a glance whilst in development (as shown in the image below).</p>


	<p><img src="http://farm1.static.flickr.com/192/460075342_987c127e66_o.jpg" alt="" /></p>


	<p>The code is pretty poor/naive, works with rails 1.0.0 (hence my trying to <a href="http://blog.seagul.co.uk/articles/2006/08/14/create-rails-projects-using-a-specific-rails-gem-version">set-up a rails 1.0.0 app</a> earlier), doesn&#8217;t work with rails 1.1.6 (not sure about versions in between) and may or may not work for you.  I kinda think it&#8217;s a good idea but there&#8217;s every chance that a) it&#8217;s not or b) there&#8217;s already a simple solution to this problem.</p>


	<p>Let me know how you get on if you decide to risk the health of your project by trying this plugin.</p>


	<p id="fn1"><sup>1</sup> She didn&#8217;t say that.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/plugin" rel="tag">plugin</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/08/14/create-rails-projects-using-a-specific-rails-gem-version">Create rails projects using a specific rails gem version</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 14 Aug 2006 22:06:00">
                    Mon, 14 Aug 2006 22:06:00
                  </span>
                </p>

                <p>I just found this when trying to create a rails project using rails 1.0.0 (having both 1.0.0 and 1.1.6 installed as gems).</p>


	<p>If the first argument to the rails command is a valid (i.e. installed) version number and surrounded by underscores then that version of the gem is used to create the rails application structure.</p>


	<p>So (with 1.0.0 and 1.1.6 gems installed)..</p>


<pre>
$ rails _1.0.0_ my-rails-proj
#-&gt; uses rails version 1

$ rails my-rails-proj
#-&gt; uses latest rails version (1.1.6)
</pre>

	<p>Although you can normally place the rails libraries into the vendor directory of a given rails app (to use that specific rails version); I had problems when placing rails 1.0.0 into a rails 1.1.6 generated app.  An error is encountered when trying to boot webrick..</p>


<code>
./script/../config/../vendor/rails/railties/lib/initializer.rb:256:in `send': undefined method `cache_template_extensions=' for ActionView::Base:Class (NoMethodError)
</code>

	<p>By passing the version argument to the rails command and then placing rails 1.0.0 into the vendor directory, everything works as expected.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/08/05/new-rails-weblob">New rails weblob</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 05 Aug 2006 00:47:00">
                    Sat, 05 Aug 2006 00:47:00
                  </span>
                </p>

                <p><a href="http://railsblob.blogspot.com/">he he he</a></p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/blog" rel="tag">blog</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/08/02/helpful-error-messages-when-active-record-objects-fail-validation-in-tests">Helpful error messages when active record objects fail validation (in tests)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 02 Aug 2006 13:47:00">
                    Wed, 02 Aug 2006 13:47:00
                  </span>
                </p>

                <p>I <a href="http://blog.seagul.co.uk/articles/2006/06/21/more-helpful-messages-for-active-record-validation-errors-in-rails-testing">posted</a> a while back about displaying the reasons for an active record model failing validation.</p>


	<p>I knew the code was hacky and nasty but didn&#8217;t realise quite how bad until I noticed how <a href="http://dev.rubyonrails.org/browser/tags/rel_1-1-0/activerecord/lib/active_record/validations.rb">simply</a>  (1 line) the same thing was implemented in <a href="http://weblog.rubyonrails.com/2006/3/28/rails-1-1-rjs-active-record-respond_to-integration-tests-and-500-other-things">Rails 1.1</a> (and above).</p>


	<p>Although it&#8217;s only useful for people still on Rails 1.0, I made a quick plugin that backports this change.  I don&#8217;t really want to put it in my subversion repository, so have just pasted the necessary code below.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment"># File init.rb</span>
<span class="ident">require</span> <span class="constant">File</span><span class="punct">.</span><span class="ident">dirname</span><span class="punct">(</span><span class="constant">__FILE__</span><span class="punct">)</span> <span class="punct">+</span> <span class="punct">'</span><span class="string">/lib/record_invalid</span><span class="punct">'</span></code></pre></div>

<div class="typocode"><pre><code class="typocode_ruby"><span class="comment"># File record_invalid.rb</span>
<span class="keyword">module </span><span class="module">ActiveRecord</span>

  <span class="keyword">class </span><span class="class">RecordInvalid</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecordError</span>
    <span class="keyword">def </span><span class="method">initialize</span><span class="punct">(</span><span class="ident">record</span><span class="punct">)</span>
      <span class="attribute">@record</span> <span class="punct">=</span> <span class="ident">record</span>
      <span class="keyword">super</span><span class="punct">(&quot;</span><span class="string">Validation failed: <span class="expr">#{@record.errors.full_messages.join(&quot;, &quot;)}</span></span><span class="punct">&quot;)</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

	<p>To create a plugin from this, create the following structure in your rails_app/vendor/plugins directory.</p>


<pre>
active_record_validation_error/
|
|--init.rb (copy contents of code above)
|
|--lib/
   |
   |--record_invalid.rb (copy content of code above)
</pre>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/activerecord" rel="tag">activerecord</a>, 
                    
                      <a href="/articles/tag/plugin" rel="tag">plugin</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/validation" rel="tag">validation</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/07/28/textmate-and-env-ruby-no-such-file-or-directory">TextMate and &quot;env: ruby: No such file or directory&quot;</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 28 Jul 2006 23:06:00">
                    Fri, 28 Jul 2006 23:06:00
                  </span>
                </p>

                <p>So, I was coming up against this problem in TextMate just recently.</p>


	<p>It&#8217;s a bit of a strange error in that you get seemingly conflicting output from TextMate.</p>


	<p>In a new TextMate document, I could run (by using the well handy, and very new to me, Ctrl-r key combo)..</p>


<pre>
/usr/bin/env ruby --version
=&gt; ruby 1.8.4 (2005-12-24) [i686-darwin8.7.1]

/usr/bin/which ruby
=&gt; /usr/local/bin/ruby

#!/usr/local/bin/ruby

puts "hello world" 
=&gt; hello world
</pre>

	<p>However, if I ran..</p>


<pre>
#!/usr/bin/env ruby

puts "hello world again" 
=&gt; env: ruby: No such file or directory
</pre>

	<p>Hmm, so <code>/usr/bin/env ruby --version</code> works, but when using the very same as the shebang interpreter we get an error.  Odd huh.</p>


	<p>Well, apparently not; if we read the textmate docs about <a href="http://macromates.com/textmate/manual/shell_commands#search_path">shell commands</a>.</p>


	<p>Although I, in no way, understand this completely; I blindly followed the instructions on that page and got TextMate back to health.</p>


	<p>In summary for those that don&#8217;t wish to read the docs..</p>


<pre>
# mkdir ~/.MacOSX/
# cat &gt;&gt; ~/.MacOSX/environment.plist
{ PATH = "/usr/local/bin"; }
</pre>

	<p><strong>Note</strong> You&#8217;ll want to change the path to the location of the binaries you want found.</p>


	<p>Then a quick log out and back in, and all is well with TextMate.  Yay.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/textmate" rel="tag">textmate</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/07/17/test-unit-abstract-test-case">Test::Unit abstract test case</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 17 Jul 2006 09:22:00">
                    Mon, 17 Jul 2006 09:22:00
                  </span>
                </p>

                <p>Having found a <a href="http://blog.seagul.co.uk/articles/2006/07/17/some-realisations-about-testing">new way to structure my tests</a>, the need for some common setup shared by multiple test cases became apparent.</p>


	<p>I think the traditional way to do this was to create a subclass of TestCase to contain the common setup code and then subclass that for your individual test cases.  This is fine, but in <a href="http://ruby-doc.org/stdlib/libdoc/test/unit/rdoc/index.html">test/unit</a>, a TestCase with no tests causes an error.</p>


	<p>One solution would be to use a module to contain the common setup and include that in your test case.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">module </span><span class="module">CommonSetup</span>
  <span class="keyword">def </span><span class="method">setup</span>
    <span class="attribute">@stack</span> <span class="punct">=</span> <span class="constant">Stack</span><span class="punct">.</span><span class="ident">new</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="keyword">class </span><span class="class">MyTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="ident">include</span> <span class="constant">CommonSetup</span>
  <span class="keyword">def </span><span class="method">test_should_accept_an_item_when_sent_push</span>
    <span class="ident">assert_nothing_raised</span> <span class="punct">{</span> <span class="attribute">@stack</span><span class="punct">.</span><span class="ident">push</span><span class="punct">(</span><span class="number">1</span><span class="punct">)</span> <span class="punct">}</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>Although this is fine, I spent a short while creating an AbstractTestCase that doesn&#8217;t complain if no tests are specified.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">test/unit</span><span class="punct">'</span>
<span class="keyword">class </span><span class="class">Test::Unit::AbstractTestCase</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="keyword">def </span><span class="method">default_test</span>
    <span class="ident">klass</span> <span class="punct">=</span> <span class="constant">self</span><span class="punct">.</span><span class="ident">class</span><span class="punct">.</span><span class="ident">to_s</span>
    <span class="ident">ancestors</span> <span class="punct">=</span> <span class="punct">(</span><span class="constant">self</span><span class="punct">.</span><span class="ident">class</span><span class="punct">.</span><span class="ident">ancestors</span> <span class="punct">-</span> <span class="punct">[</span><span class="constant">self</span><span class="punct">.</span><span class="ident">class</span><span class="punct">]).</span><span class="ident">collect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">ancestor</span><span class="punct">|</span> <span class="ident">ancestor</span><span class="punct">.</span><span class="ident">to_s</span> <span class="punct">}</span>
    <span class="keyword">super</span> <span class="keyword">unless</span> <span class="ident">klass</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">AbstractTestCase</span><span class="punct">/</span> <span class="keyword">or</span> <span class="ident">ancestors</span><span class="punct">.</span><span class="ident">first</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">AbstractTestCase</span><span class="punct">/</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>Any test case (TestBase in this example) that inherits from AbstractTestCase can now contain setup and teardown methods but not have to worry about missing tests.  In order to maintain expected behaviour, any test case subclassed from TestBase will still complain if tests are missing.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">TestBase</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">AbstractTestCase</span>
  <span class="comment"># 'No test were specified' error is not thrown</span>
  <span class="keyword">def </span><span class="method">setup</span>
    <span class="attribute">@bar</span> <span class="punct">=</span> <span class="punct">{</span> <span class="symbol">:foo</span> <span class="punct">=&gt;</span> <span class="number">123</span> <span class="punct">}</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="keyword">class </span><span class="class">RealTest</span> <span class="punct">&lt;</span> <span class="constant">TestBase</span>
  <span class="comment"># Utilises TestBase#setup</span>
  <span class="keyword">def </span><span class="method">test_example</span>
    <span class="ident">assert_equal</span> <span class="number">123</span><span class="punct">,</span> <span class="attribute">@bar</span><span class="punct">[</span><span class="symbol">:foo</span><span class="punct">]</span>
  <span class="keyword">end</span>
<span class="keyword">end</span>
<span class="keyword">class </span><span class="class">ShouldErrorTest</span> <span class="punct">&lt;</span> <span class="constant">TestBase</span>
  <span class="comment"># 'No tests were specified' error</span>
<span class="keyword">end</span></code></pre></div>

	<p>I then figured that you may want more than one level of abstract test case, i.e. be able to define at the TestCase class level whether or not a test case was abstract.  This isn&#8217;t properly tested but it seems to work ok.</p>


	<p><strong>Note</strong> This isn&#8217;t doing exactly what I thought (the default test case is default_test, not test_default).  This works because it just creates an empty test in your test case.  This breaks behaviour in test cases that subclass your abstract test case as they too will already have at least one test defined.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">test/unit</span><span class="punct">'</span>
<span class="keyword">class </span><span class="class">Test::Unit::TestCase</span>
  <span class="keyword">class </span><span class="punct">&lt;&lt;</span> <span class="constant">self</span>
    <span class="keyword">def </span><span class="method">abstract</span>
      <span class="constant">self</span><span class="punct">.</span><span class="ident">class_eval</span> <span class="keyword">do</span>
        <span class="keyword">def </span><span class="method">test_default</span>
        <span class="keyword">end</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>By sending the abstract message to any TestCase class, no errors will be reported when no tests are specified.  It does this by overriding the test_default method; which is the method that raises the error if no other tests are specified.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">AbstractTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="ident">abstract</span>
  <span class="comment"># 'No test were specified' error is not thrown</span>
<span class="keyword">end</span>
<span class="keyword">class </span><span class="class">NormalTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="comment"># 'No test were specified' error</span>
<span class="keyword">end</span></code></pre></div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                      <a href="/articles/tag/xunit" rel="tag">xunit</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/07/17/some-realisations-about-testing">Some realisations about testing</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 17 Jul 2006 09:19:00">
                    Mon, 17 Jul 2006 09:19:00
                  </span>
                </p>

                <p>Having been predominantly involved in <a href="http://www.rubyonrails.com">Rails</a> development just recently, <a href="http://api.rubyonrails.com/classes/Fixtures.html">fixtures</a> have taken on a slightly different meaning to what I now believe to be the original understanding.  Having recently re-read <a href="http://www.amazon.co.uk/gp/product/0321146530/202-8808398-1811851?v=glance&#38;n=266239">Test Driven Development: By Example</a> I re-discovered the &#8216;original&#8217; meaning of the word (essentially shared objects used by all tests in a test case).</p>


	<p>This has made me think about the way that I&#8217;ve been structuring my tests (or not structuring them as the case may be).  I have never been a fan of the setup and teardown methods provided to us in <a href="http://en.wikipedia.org/wiki/XUnit">xUnit</a> and I now believe this to be due to my misunderstanding of the term fixture and therefore their intention.  This has led to my test cases growing very large and containing many disparate tests.  If there was any separation of the testcase then it was usually based on functionality of a particular method (which separately leads me to believe that they may have been better expressed in a new object).  I now understand that test cases should be split to contain tests that rely on a common test fixture.  As soon as I started to do this, the setup and (to a lesser degree) teardown methods have become much more useful.</p>


	<p>I&#8217;ve also started to create my test cases as anonymous classes derived from Test::Unit::TestCase.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Class</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span><span class="punct">)</span> <span class="keyword">do</span>
  <span class="keyword">def </span><span class="method">test_</span>
    <span class="ident">assert</span> <span class="constant">true</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>I find that this helps when trying to determine where a new test should be placed.  If the class has a name I&#8217;m tempted to scan that and make a decision as to whether a new test belongs in this case.  By keeping them anonymous, I have to inspect the test fixture in order to understand whether a new test belongs here.</p>


	<p><strong>Note</strong> I may also add a comment right below Class.new to explicitly specify the fixture for this testcase.  This may seem to go against not naming the classes in the first place but I think part of the problem with class names is the lack of punctuation and therefore the difficulty in clearly expressing the test fixture.</p>


	<p>I&#8217;ve chosen a somewhat contrived example to demonstrate my new found test structure.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Class</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span><span class="punct">)</span> <span class="keyword">do</span>
  <span class="comment"># An empty stack</span>

  <span class="keyword">def </span><span class="method">setup</span>
    <span class="attribute">@stack</span> <span class="punct">=</span> <span class="constant">Stack</span><span class="punct">.</span><span class="ident">new</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_accept_an_item_when_sent_push</span>
    <span class="ident">assert_nothing_raised</span> <span class="punct">{</span> <span class="attribute">@stack</span><span class="punct">.</span><span class="ident">push</span><span class="punct">(</span><span class="number">1</span><span class="punct">)</span> <span class="punct">}</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_complain_when_sent_top</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">StackUnderflowError</span><span class="punct">)</span> <span class="punct">{</span> <span class="attribute">@stack</span><span class="punct">.</span><span class="ident">top</span> <span class="punct">}</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">test_should_complain_when_sent_pop</span>
    <span class="ident">assert_raise</span><span class="punct">(</span><span class="constant">StackUnderflowError</span><span class="punct">)</span> <span class="punct">{</span> <span class="attribute">@stack</span><span class="punct">.</span><span class="ident">pop</span> <span class="punct">}</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

	<p>The fixture for this test is an empty stack.  The individual tests prod and query the empty stack to ensure that it behaves as expected.  Although the example above is incredibly simple, I have consistently found that my individual test methods become much smaller.</p>


	<p>Notice that the names of the tests all start &#8216;test_should&#8217;.  Not only does this help us think about the responsibilities of the object; but it enables us to maintain living system specifications based on the tests.  I believe this idea first came from <a href="http://agiledox.sourceforge.net/index.html">testdox for Java</a> but was introduced to me by <a href="http://www.reevoo.com/blogs/bengriffiths/">Ben</a> at <a href="http://www.reevoo.com">work</a>.  In fact Ben has written a cool <a href="http://www.reevoo.com/blogs/bengriffiths/2006/04/05/rails-agiledox-browser/">Agiledox server</a> that displays the system specifications for your rails project.</p>


	<p>The realisations set out above have come at around the same time as my taking more of an interest in <a href="http://rspec.rubyforge.org/">rSpec</a> (the stack test above has been adapted directly from one of the rSpec examples); a <a href="http://behaviour-driven.org/">behaviour driven development</a> framework for <a href="http://www.ruby-lang.org">ruby</a>.  I haven&#8217;t done any real work with rSpec yet but am hoping it might improve the way I think of both testing and OO design in general.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/agiledox" rel="tag">agiledox</a>, 
                    
                      <a href="/articles/tag/bdd" rel="tag">bdd</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/rspec" rel="tag">rspec</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/tdd" rel="tag">tdd</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/07/14/textmate-command-to-display-active-record-column-attributes">Textmate command to display Active Record column attributes</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 14 Jul 2006 08:18:00">
                    Fri, 14 Jul 2006 08:18:00
                  </span>
                </p>

                <p>I find myself constantly visiting either the console or the mysql command line to check out the attributes (columns) of <a href="http://api.rubyonrails.com/classes/ActiveRecord/Base.html">active record</a> objects.</p>


	<p>I know there is a <a href="http://blogs.pragprog.com/cgi-bin/pragdave.cgi/Tech/Ruby/AnnotateModels.rdoc">plugin</a> by <a href="http://blogs.pragprog.com/cgi-bin/pragdave.cgi">Dave Thomas</a> that places the table structure within the model code itself.  To be honest I&#8217;ve never tried this and it might well suffice (although I&#8217;m not 100% convinced I like the idea).</p>


	<p>Anyhoo, I just spent some time whilst on the train hacking together a basic <a href="http://macromates.com/">textmate</a> command that displays a tooltip containing the table structure.  It&#8217;s very basic (though you wouldn&#8217;t have thought it based on the amount of time it took me together<sup><a href="#fn1">1</a></sup>); but seems to work ok.</p>


	<p><img src="http://farm1.static.flickr.com/236/460082493_49ff4cd1ed_o.png" alt="" /></p>


	<p>The code is below.  You&#8217;ll need to add a ruby command in the ruby textmate bundle, setting the intput to &#8216;selected text&#8217; or &#8216;nothing&#8217;, the output to &#8216;show as tooltip&#8217; and preferably a hotkey that isn&#8217;t one of the ones you use every day (however tempting that is).</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment">#! /usr/local/bin/ruby</span>

<span class="ident">project</span> <span class="punct">=</span> <span class="constant">ENV</span><span class="punct">['</span><span class="string">TM_PROJECT_DIRECTORY</span><span class="punct">']</span>
<span class="ident">word</span> <span class="punct">=</span> <span class="constant">ENV</span><span class="punct">['</span><span class="string">TM_CURRENT_WORD</span><span class="punct">']</span>

<span class="ident">require</span> <span class="punct">&quot;</span><span class="string"><span class="expr">#{project}</span>/config/boot</span><span class="punct">&quot;</span>
<span class="ident">require</span> <span class="punct">&quot;</span><span class="string"><span class="expr">#{project}</span>/config/environment</span><span class="punct">&quot;</span>

<span class="ident">klass</span> <span class="punct">=</span> <span class="constant">Object</span><span class="punct">.</span><span class="ident">const_get</span><span class="punct">(</span><span class="ident">word</span><span class="punct">)</span> <span class="keyword">rescue</span> <span class="constant">nil</span>
<span class="keyword">if</span> <span class="ident">klass</span> <span class="keyword">and</span> <span class="ident">klass</span><span class="punct">.</span><span class="keyword">class </span><span class="class">==</span> <span class="ident">Class</span> <span class="ident">and</span> <span class="ident">klass</span><span class="punct">.</span><span class="ident">ancestors</span><span class="punct">.</span><span class="ident">include?</span><span class="punct">(</span><span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span><span class="punct">)</span>
  <span class="ident">columns</span> <span class="punct">=</span> <span class="ident">klass</span><span class="punct">.</span><span class="ident">columns_hash</span>

  <span class="ident">data</span> <span class="punct">=</span> <span class="punct">[]</span>
  <span class="ident">data</span> <span class="punct">+=</span> <span class="punct">[%w[</span><span class="string">column primary sql_type default</span><span class="punct">]]</span>
  <span class="ident">data</span> <span class="punct">+=</span> <span class="punct">[%w[</span><span class="string">------ ------- -------- -------</span><span class="punct">]]</span>
  <span class="ident">data</span> <span class="punct">+=</span> <span class="ident">columns</span><span class="punct">.</span><span class="ident">collect</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">col</span><span class="punct">,</span> <span class="ident">attrs</span><span class="punct">|</span> <span class="punct">[</span><span class="ident">col</span><span class="punct">,</span> <span class="ident">attrs</span><span class="punct">.</span><span class="ident">primary</span><span class="punct">.</span><span class="ident">to_s</span><span class="punct">,</span> <span class="ident">attrs</span><span class="punct">.</span><span class="ident">sql_type</span><span class="punct">.</span><span class="ident">to_s</span><span class="punct">,</span> <span class="ident">attrs</span><span class="punct">.</span><span class="ident">default</span><span class="punct">.</span><span class="ident">to_s</span><span class="punct">]</span> <span class="punct">}</span>

  <span class="constant">STDOUT</span> <span class="punct">&lt;&lt;</span> <span class="ident">data</span><span class="punct">.</span><span class="ident">inject</span><span class="punct">('</span><span class="string"></span><span class="punct">')</span> <span class="keyword">do</span> <span class="punct">|</span><span class="ident">output</span><span class="punct">,</span> <span class="ident">array</span><span class="punct">|</span> 
    <span class="ident">output</span> <span class="punct">+</span> <span class="ident">array</span><span class="punct">.</span><span class="ident">inject</span><span class="punct">('</span><span class="string"></span><span class="punct">')</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">row_str</span><span class="punct">,</span> <span class="ident">value</span><span class="punct">|</span> <span class="ident">row_str</span> <span class="punct">+</span> <span class="ident">value</span><span class="punct">.</span><span class="ident">ljust</span><span class="punct">(</span><span class="number">20</span><span class="punct">)</span> <span class="punct">}</span> <span class="punct">+</span> <span class="punct">&quot;</span><span class="string"><span class="escape">\n</span></span><span class="punct">&quot;</span>
  <span class="keyword">end</span>
<span class="keyword">elsif</span> <span class="ident">klass</span> <span class="keyword">and</span> <span class="ident">klass</span><span class="punct">.</span><span class="keyword">class </span><span class="class">==</span> <span class="ident">Class</span> <span class="ident">and</span> <span class="keyword">not</span> <span class="ident">klass</span><span class="punct">.</span><span class="ident">ancestors</span><span class="punct">.</span><span class="ident">include?</span><span class="punct">(</span><span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span><span class="punct">)</span>
  <span class="constant">STDOUT</span> <span class="punct">&lt;&lt;</span> <span class="punct">&quot;</span><span class="string"><span class="expr">#{word}</span> is not an Active Record derived class</span><span class="punct">&quot;</span>
<span class="keyword">else</span>
  <span class="constant">STDOUT</span> <span class="punct">&lt;&lt;</span> <span class="punct">&quot;</span><span class="string"><span class="expr">#{word}</span> was not recognised as a class</span><span class="punct">&quot;</span>
<span class="keyword">end</span></code></pre></div>

	<p>It relies on you having your entire rails project (the folder right above app, config, script etc) open in textmate (in order to find the config files).  With that, just click on the name of an active record class (it has to be the actual class name at present, it&#8217;d be cool if it also worked based on the class definition you are currently in too) and hit your hotkey of choice (best to use the one you assigned to this command).  Hey presto, a tooltip containing your table structure.</p>


	<p>One odd thing I&#8217;ve noticed is that it never recognises standard class constants.  It should display &#8216;this is not an active record derived class&#8217; but instead always displays &#8216;was not recognised as a class&#8217;.  Oh well.</p>


	<p>Anyone find this remotely useful or want to finish off what I&#8217;ve started?</p>


	<p>[1] I spent ages trying to develop within the textmate bundle editor before realising it&#8217;d be a helluva lot quicker and easier to develop in textmate proper.  Hmmm.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/activerecord" rel="tag">activerecord</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/textmate" rel="tag">textmate</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/07/12/using-in-memory-active-record-objects-with-associations-for-testing">Using in memory Active Record objects with associations for testing</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 12 Jul 2006 01:23:00">
                    Wed, 12 Jul 2006 01:23:00
                  </span>
                </p>

                <p>Hitting the database in testing is bad.</p>


	<p>Something that I&#8217;ve found relatively useful at <a href="http://www.reevoo.com">work</a> is to use real <a href="http://api.rubyonrails.com/classes/ActiveRecord/Base.html">Active Record</a> objects without any persistence (basically use AR#new and not AR#save[!] or AR#create[!]).  When using standard techniques to create the association objects in memory you only get one side of the association at a time.  Consider the following.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">Person</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span>
  <span class="ident">has_many</span> <span class="symbol">:addresses</span>
<span class="keyword">end</span>
<span class="keyword">class </span><span class="class">Address</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span>
  <span class="ident">belongs_to</span> <span class="symbol">:person</span>
<span class="keyword">end</span>

<span class="comment"># One sided relationship with parent getting access to child</span>
<span class="ident">chris</span> <span class="punct">=</span> <span class="constant">Person</span><span class="punct">.</span><span class="ident">new</span>
<span class="ident">home</span> <span class="punct">=</span> <span class="ident">chris</span><span class="punct">.</span><span class="ident">addresses</span><span class="punct">.</span><span class="ident">build</span>

<span class="ident">chris</span><span class="punct">.</span><span class="ident">addresses</span><span class="punct">.</span><span class="ident">first</span>
<span class="punct">=&gt;</span> <span class="comment">#&lt;home&gt;</span>
<span class="ident">home</span><span class="punct">.</span><span class="ident">person</span>
<span class="punct">=&gt;</span> <span class="constant">nil</span>

<span class="comment"># One sided relationship with child getting access to parent</span>
<span class="ident">home</span> <span class="punct">=</span> <span class="constant">Address</span><span class="punct">.</span><span class="ident">new</span>
<span class="ident">chris</span> <span class="punct">=</span> <span class="ident">home</span><span class="punct">.</span><span class="ident">build_person</span>

<span class="ident">chris</span><span class="punct">.</span><span class="ident">addresses</span>
<span class="punct">=&gt;</span> <span class="punct">[]</span>
<span class="ident">home</span><span class="punct">.</span><span class="ident">person</span>
<span class="punct">=&gt;</span> <span class="comment">#&lt;chris&gt;</span>

<span class="comment"># The example above that creates the address first could also have been written as.</span>
<span class="comment"># chris = Person.new</span>
<span class="comment"># home = Address.new(:person =&gt; chris)</span></code></pre></div>

	<p>You can see that in each case, only one side of the relationship has access to the other.  If we were persisting the objects then the relationship would be two way via a database lookup.  We can get a two way relationship in memory; although it has a certain duplication smell about it.  Assuming the same models as above, we can amend the above examples like so.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment"># First example</span>
<span class="ident">chris</span> <span class="punct">=</span> <span class="constant">Person</span><span class="punct">.</span><span class="ident">new</span>
<span class="ident">home</span> <span class="punct">=</span> <span class="ident">chris</span><span class="punct">.</span><span class="ident">addresses</span><span class="punct">.</span><span class="ident">build</span><span class="punct">(</span><span class="symbol">:person</span> <span class="punct">=&gt;</span> <span class="ident">chris</span><span class="punct">)</span>

<span class="ident">chris</span><span class="punct">.</span><span class="ident">addresses</span><span class="punct">.</span><span class="ident">first</span>
<span class="punct">=&gt;</span> <span class="comment">#&lt;home&gt;</span>
<span class="ident">home</span><span class="punct">.</span><span class="ident">person</span>
<span class="punct">=&gt;</span> <span class="comment">#&lt;chris&gt;</span>

<span class="comment"># Second example</span>
<span class="ident">home</span> <span class="punct">=</span> <span class="constant">Address</span><span class="punct">.</span><span class="ident">new</span>
<span class="ident">chris</span> <span class="punct">=</span> <span class="ident">home</span><span class="punct">.</span><span class="ident">build_person</span><span class="punct">(</span><span class="symbol">:addresses</span> <span class="punct">=&gt;</span> <span class="punct">[</span><span class="ident">home</span><span class="punct">])</span>

<span class="ident">home</span><span class="punct">.</span><span class="ident">person</span>
<span class="punct">=&gt;</span> <span class="comment">#&lt;chris&gt;</span>
<span class="ident">chris</span><span class="punct">.</span><span class="ident">addresses</span><span class="punct">.</span><span class="ident">first</span>
<span class="punct">=&gt;</span> <span class="comment">#&lt;home&gt;</span></code></pre></div>

	<p>I&#8217;ve occasionally used this in place of stubbing methods but am still not 100% convinced of the definite benefits one way or another.  I do have some definite disadvantages of stubbing methods (nothing exciting, they&#8217;ve almost certainly been noted by many others in the past) which I&#8217;ll note down at a later date.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/activerecord" rel="tag">activerecord</a>, 
                    
                      <a href="/articles/tag/learning" rel="tag">learning</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/07/12/ruby-hashes-with-default-values">Ruby hashes with default values</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 12 Jul 2006 01:17:00">
                    Wed, 12 Jul 2006 01:17:00
                  </span>
                </p>

                <p>I found that on several occasions I&#8217;ve wanted to create a hash that increments the number of instances of a given key.  We could do something manual like.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">hash</span> <span class="punct">=</span> <span class="constant">Hash</span><span class="punct">.</span><span class="ident">new</span>
<span class="keyword">def </span><span class="method">increment_count</span><span class="punct">(</span><span class="ident">hash</span><span class="punct">,</span> <span class="ident">key</span><span class="punct">)</span>
  <span class="ident">hash</span><span class="punct">[</span><span class="ident">key</span><span class="punct">]</span> <span class="punct">||=</span> <span class="number">0</span> <span class="comment"># Sets any new keys to 0.</span>
  <span class="ident">hash</span><span class="punct">[</span><span class="ident">key</span><span class="punct">]</span> <span class="punct">+=</span> <span class="number">1</span>
<span class="keyword">end</span></code></pre></div>

	<p>This is fine; but can be written more concisely.  If we supply an object to Hash::new then that object becomes the default value for all missing keys in the hash.  The above example is shortened by one line.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">hash</span> <span class="punct">=</span> <span class="constant">Hash</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="number">0</span><span class="punct">)</span>
<span class="keyword">def </span><span class="method">increment_count</span><span class="punct">(</span><span class="ident">hash</span><span class="punct">,</span> <span class="ident">key</span><span class="punct">)</span>
  <span class="ident">hash</span><span class="punct">[</span><span class="ident">key</span><span class="punct">]</span> <span class="punct">+=</span> <span class="number">1</span>
<span class="keyword">end</span></code></pre></div>

	<p>A problem arises when we want to use an object that isn&#8217;t immutable (in this case, basically anything other than a Fixnum) as the default value.  The example that I came across a couple of times today was using an empty array as the default value.  If we try to use the same method as above, we experience problems.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">hash</span> <span class="punct">=</span> <span class="constant">Hash</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">Array</span><span class="punct">.</span><span class="ident">new</span><span class="punct">)</span>
<span class="ident">hash</span><span class="punct">[</span><span class="symbol">:key_one</span><span class="punct">]</span>
<span class="punct">=&gt;</span> <span class="punct">[]</span>
<span class="ident">hash</span><span class="punct">[</span><span class="symbol">:key_two</span><span class="punct">]</span> <span class="punct">&lt;&lt;</span> <span class="number">99</span>
<span class="punct">=&gt;</span> <span class="punct">[</span><span class="number">99</span><span class="punct">]</span>
<span class="ident">hash</span><span class="punct">[</span><span class="symbol">:key_one</span><span class="punct">]</span>
<span class="punct">=&gt;</span> <span class="punct">[</span><span class="number">99</span><span class="punct">]</span> <span class="comment"># is actually the same array amended in the step above</span></code></pre></div>

	<p>I&#8217;ve known that there was a way around this for a long time but have never bothered to look it up.  I finally got round to looking at it today, and it is, unsurprisingly, very simple.  We supply the hash constructor with a block.  This block is called for any missing key and supplied with the hash and said key.  The example above becomes.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">hash</span> <span class="punct">=</span> <span class="constant">Hash</span><span class="punct">.</span><span class="ident">new</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">hash</span><span class="punct">,</span> <span class="ident">key</span><span class="punct">|</span> <span class="ident">hash</span><span class="punct">[</span><span class="ident">key</span><span class="punct">]</span> <span class="punct">=</span> <span class="constant">Array</span><span class="punct">.</span><span class="ident">new</span> <span class="punct">}</span>
<span class="ident">hash</span><span class="punct">[</span><span class="symbol">:key_one</span><span class="punct">]</span>
<span class="punct">=&gt;</span> <span class="punct">[]</span>
<span class="ident">hash</span><span class="punct">[</span><span class="symbol">:key_two</span><span class="punct">]</span> <span class="punct">&lt;&lt;</span> <span class="number">99</span>
<span class="punct">=&gt;</span> <span class="punct">[</span><span class="number">99</span><span class="punct">]</span>
<span class="ident">hash</span><span class="punct">[</span><span class="symbol">:key_one</span><span class="punct">]</span>
<span class="punct">=&gt;</span> <span class="punct">[]</span></code></pre></div>

	<p>I say I looked it up today but to be fair there&#8217;s every chance that I was well aware of this at some point in the past&#8230;</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/learning" rel="tag">learning</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/07/12/trying-to-learn">Trying to learn</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 12 Jul 2006 01:15:00">
                    Wed, 12 Jul 2006 01:15:00
                  </span>
                </p>

                <p>I&#8217;ve decided I&#8217;m going to attempt to write down some things that I learn about ruby.  I &#8216;learn&#8217; the same stuff all the time due to the nature of my very bad memory.  In an attempt to learn some things just the once I&#8217;m going to try write them down.  It probably wont help.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/learning" rel="tag">learning</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/07/05/very-simple-micro-id-verifier">Very simple Micro Id Verifier</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 05 Jul 2006 23:22:00">
                    Wed, 05 Jul 2006 23:22:00
                  </span>
                </p>

                <p>I just finished up the initial copy of a Ruby implementation of <a href="http://chimprawk.blogspot.com/">Fred Stutzman&#8217;s</a> <a href="http://www.microid.org/">Micro Id</a> <a href="http://chimprawk.blogspot.com/2006/06/simple-microid-verifier.html">Verifier</a>.</p>


	<p>View the source <a href="http://dev.seagul.co.uk/repository/browse/micro_id_verifier">on-line</a> or checkout from anonymous subversion.</p>


<div class="typocode">
<pre>
# svn co svn://dev.seagul.co.uk/micro_id_verifier
</pre>
</div>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/id" rel="tag">id</a>, 
                    
                      <a href="/articles/tag/micro" rel="tag">micro</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/06/30/very-very-lightweight-mocking-ish">Very very lightweight mocking(ish)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 30 Jun 2006 12:08:00">
                    Fri, 30 Jun 2006 12:08:00
                  </span>
                </p>

                <p><a href="http://www.floehopper.org/">James</a> has been developing a great <a href="http://www.martinfowler.com/articles/mocksArentStubs.html">mocking</a> framework at <a href="http://www.reevoo.com">work</a> which makes life real easy when it comes to testing interaction between objects.</p>


	<p>I&#8217;ve spent a couple of hours this week re-implementing <a href="http://chimprawk.blogspot.com">Fred Stutzmans</a> <a href="http://chimprawk.blogspot.com/2006/06/simple-microid-verifier.html">Micro Id Verifier</a> in ruby (I&#8217;ll post it soon, just some database persistence to add).  The job of the validator is to connect to a given url and compare any <a href="http://microid.org/">micro_id</a> found on that page with an expected micro_id supplied by the user.  All of my development has been off-line yet I needed a way to test that my objects were doing their job (i.e. connecting to the Internet).  It&#8217;s actually irrelevant that I was off-line at the time, I&#8217;d still need a repeatable way of ensuring my objects are doing their jobs.</p>


	<p>I&#8217;m using <a href="http://ruby-doc.org/stdlib/libdoc/net/http/rdoc/index.html">Net::HTTP</a> to look after grabbing the html for a given page and am certainly not worried about testing the workings of that library.  What I wanted to know, however, was that my client was utilising Net::HTTP in the way expected.  I didn&#8217;t have access to the mocking framework used at work so I fell back to a very lightweight method that we&#8217;ve used previously.</p>


	<p>The idea is to override the methods of an object that you expect to be called.  When the overridden method is called, we add the message to a log for later inspection.</p>


	<p>The implementation I have at the moment comprises four methods, although we could quite easily do away with &#8216;stub_instance_method&#8217; (it just adds some safety checking to &#8216;define_instance_method&#8217;).</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">Object</span>

  <span class="keyword">def </span><span class="method">metaclass</span>
    <span class="keyword">class </span><span class="punct">&lt;&lt;</span> <span class="constant">self</span><span class="punct">;</span> <span class="constant">self</span><span class="punct">;</span> <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">define_instance_method</span><span class="punct">(</span><span class="ident">sym</span><span class="punct">,</span> <span class="punct">&amp;</span><span class="ident">block</span><span class="punct">)</span>
    <span class="ident">metaclass</span><span class="punct">.</span><span class="ident">__send__</span><span class="punct">(</span><span class="symbol">:define_method</span><span class="punct">,</span> <span class="ident">sym</span><span class="punct">,</span> <span class="punct">&amp;</span><span class="ident">block</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">stub_instance_method</span><span class="punct">(</span><span class="ident">sym</span><span class="punct">,</span> <span class="punct">&amp;</span><span class="ident">block</span><span class="punct">)</span>
    <span class="keyword">raise</span> <span class="punct">&quot;</span><span class="string"><span class="expr">#{self}</span> does not respond to &lt;<span class="expr">#{sym}</span>&gt; and therefore cannot be stubbed</span><span class="punct">&quot;</span> <span class="keyword">unless</span> <span class="constant">self</span><span class="punct">.</span><span class="ident">respond_to?</span><span class="punct">(</span><span class="ident">sym</span><span class="punct">)</span>
    <span class="ident">define_instance_method</span><span class="punct">(</span><span class="ident">sym</span><span class="punct">,</span> <span class="punct">&amp;</span><span class="ident">block</span><span class="punct">)</span>
  <span class="keyword">end</span>

  <span class="keyword">def </span><span class="method">__log__</span>
    <span class="attribute">@__log__</span> <span class="punct">||=</span> <span class="punct">[]</span>
  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

	<p>A (partially adapted and potentially non-working) example of this code being used in my tests is as follows.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">def </span><span class="method">test_should_use_net_http_to_get_html_content</span>
  <span class="ident">url</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">http://localhost/page.htm</span><span class="punct">'</span>
  <span class="ident">net_http</span> <span class="punct">=</span> <span class="constant">Object</span><span class="punct">.</span><span class="ident">new</span>
  <span class="ident">net_http</span><span class="punct">.</span><span class="ident">define_instance_method</span><span class="punct">(</span><span class="symbol">:get</span><span class="punct">)</span> <span class="punct">{</span> <span class="punct">|</span><span class="ident">path</span><span class="punct">|</span> <span class="ident">__log__</span> <span class="punct">&lt;&lt;</span> <span class="punct">&quot;</span><span class="string">get(<span class="expr">#{path}</span>)</span><span class="punct">&quot;</span> <span class="punct">}</span>
  <span class="ident">http_client</span> <span class="punct">=</span> <span class="constant">HttpClient</span><span class="punct">.</span><span class="ident">new</span>
  <span class="ident">http_client</span><span class="punct">.</span><span class="ident">get_html</span><span class="punct">(</span><span class="ident">url</span><span class="punct">,</span> <span class="ident">net_http</span><span class="punct">)</span>

  <span class="ident">assert_equal</span> <span class="punct">['</span><span class="string">get(/page.htm)</span><span class="punct">'],</span> <span class="ident">net_http</span><span class="punct">.</span><span class="ident">__log__</span>
<span class="keyword">end</span></code></pre></div>

	<p>I define a &#8216;mock&#8217; Net::HTTP object (net_http) that records a message when it gets sent the &#8216;get&#8217; message.  I can then check the log to ensure that the expected method was called; and be (hopefully) safe in the knowledge that when I supply an actual Net::HTTP object the code does what I expect.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/mock" rel="tag">mock</a>, 
                    
                      <a href="/articles/tag/mocking" rel="tag">mocking</a>, 
                    
                      <a href="/articles/tag/objects" rel="tag">objects</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/06/25/generating-a-microid-with-ruby">Generating a MicroId with Ruby</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sun, 25 Jun 2006 13:18:00">
                    Sun, 25 Jun 2006 13:18:00
                  </span>
                </p>

                <p>Very naive Ruby method to create a <a href="http://www.microid.org">MicroId</a> for a given email and url.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">require</span> <span class="punct">'</span><span class="string">digest/sha1</span><span class="punct">'</span>

<span class="keyword">def </span><span class="method">micro_id</span><span class="punct">(</span><span class="ident">email</span><span class="punct">,</span> <span class="ident">url</span><span class="punct">)</span>
  <span class="ident">email_digest</span> <span class="punct">=</span> <span class="constant">Digest</span><span class="punct">::</span><span class="constant">SHA1</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="ident">email</span><span class="punct">).</span><span class="ident">to_s</span>
  <span class="ident">url_digest</span> <span class="punct">=</span> <span class="constant">Digest</span><span class="punct">::</span><span class="constant">SHA1</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="ident">url</span><span class="punct">).</span><span class="ident">to_s</span>
  <span class="constant">Digest</span><span class="punct">::</span><span class="constant">SHA1</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="ident">email_digest</span> <span class="punct">+</span> <span class="ident">url_digest</span><span class="punct">).</span><span class="ident">to_s</span>
<span class="keyword">end</span></code></pre></div>

	<p>Note that there is no validation of the MicroId in this code at all.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/microid" rel="tag">microid</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/06/21/more-helpful-messages-for-active-record-validation-errors-in-rails-testing">More helpful messages for Active Record validation errors in Rails testing</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 21 Jun 2006 08:10:00">
                    Wed, 21 Jun 2006 08:10:00
                  </span>
                </p>

                <p>In testing (and production code) <a href="http://www.reevoo.com">we</a> always try to persist <a href="http://api.rubyonrails.com/classes/ActiveRecord/Base.html">Active Record</a> models with the bang variants (save! and create!).  This allows us to <a href="http://www.martinfowler.com/ieeeSoftware/failFast.pdf">fail fast</a> if any of our models fail our  <a href="http://api.rubyonrails.com/classes/ActiveRecord/Validations/ClassMethods.html">validation</a> rules.</p>


	<p>The problem is that the standard <a href="http://ruby-doc.org/stdlib/libdoc/test/unit/rdoc/index.html">test/unit</a> reporting framework displays the exception without any details of why the validation failed.</p>


<div class="typocode">
<pre>
 1) Error:
test_should_fail_validation(AardvarkTest):
ActiveRecord::RecordInvalid:ActiveRecord::RecordInvalid
   /opt/local/lib/ruby/gems/1.8/gems/activerecord-1.13.2/lib/active_record/validations.rb:711:in 'save!'
   /opt/local/lib/ruby/gems/1.8/gems/activerecord-1.13.2/lib/active_record/validations.rb:673:in 'create!'
   /Users/chrisroos/dev/example_rails/test/unit/aardvark_test.rb:22:in 'test_should_fail_validation'

1 tests, 0 assertions, 0 failures, 1 errors
</pre>
</div>

	<p><strong>Note.</strong> This isn&#8217;t the fault of test/unit.  It has to deal with generic exceptions and so cannot &#8216;know&#8217; that Active Record Exceptions can be used to find the reason for the failure.</p>


	<p>At this point, it would be very easy to jump into the code of the Active Record model, check out the validations and satisfy them within your code.  However, it&#8217;d be much cooler if we could just add the reason for the failures to the error message that is displayed.</p>


	<p>I initially played around with a method that took a block and would wrap the block with a begin/rescue clause to explicitly catch RecordInvalid exceptions, displaying the reason for failure.</p>


	<p>Then I thought it&#8217;d be cool if we could integrate slightly more with both test/unit and <a href="http://www.rubyonrails.com">rails</a>.  The result is a <a href="http://wiki.rubyonrails.org/rails/pages/Plugins">plugin</a> (<a href="http://dev.seagul.co.uk/repository/browse/plugins/test_unit_active_record_errors">source</a>) that can be installed as follows.</p>


<div class="typocode">
<pre>
script/plugin install svn://dev.seagul.co.uk/plugins/test_unit_active_record_errors
</pre>
</div>

	<p>The output from a failed validation now includes the validation errors.  Yay.</p>


<div class="typocode">
<pre>
 1) Error:
test_should_fail_validation(AardvarkTest):
ActiveRecord::RecordInvalid: ActiveRecord::RecordInvalid
   /opt/local/lib//gems/1.8/gems/activerecord-1.13.2/lib/active_record/validations.rb:711:in `save!'
   /opt/local/lib/ruby/gems/1.8/gems/activerecord-1.13.2/lib/active_record/validations.rb:673:in `create!'
   /Users/chrisroos/dev/example_rails/test/unit/aardvark_test.rb:22:in `__test_should_fail_validation_without_custom_error_handling'
   /Users/chrisroos/dev/example_rails/config/../vendor/plugins/test_unit_active_record_errors/lib/test_unit_active_record_errors.rb:29:in `__send__'
   /Users/chrisroos/dev/example_rails/config/../vendor/plugins/test_unit_active_record_errors/lib/test_unit_active_record_errors.rb:29:in `test_should_fail_validation'
   /Users/chrisroos/dev/example_rails/config/../vendor/plugins/test_unit_active_record_errors/lib/test_unit_active_record_errors.rb:27:in `test_should_fail_validation'
ActiveRecord Errors:Surname can't be blank, Email can't be blank

1 tests, 0 assertions, 0 failures, 1 errors
</pre>
</div>

	<p>The code is pretty hacky and includes no tests.  It&#8217;s only been tested on Mac Os <span class="caps">X 10</span>.4.6 with Ruby 1.8.2 and Rails 1.0.0 but please feel free to do what you will with it if you think it might be of some use to you.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/active" rel="tag">active</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/record" rel="tag">record</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                      <a href="/articles/tag/validations" rel="tag">validations</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/06/02/rails-plugin-to-utilise-sqlite-for-testing">Rails plugin to utilise Sqlite for testing</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 02 Jun 2006 16:41:00">
                    Fri, 02 Jun 2006 16:41:00
                  </span>
                </p>

                <p>I feel pretty honoured that <a href="http://nubyonrails.com/">Geoffrey Grosenbach</a>, of <a href="http://podcast.rubyonrails.com/">Rails podcast</a> fame (plus so much more) has <a href="http://nubyonrails.com/articles/2006/06/01/san-francisco-sqlite3-memory-tests-asteroids">used</a> the stuff <a href="http://blog.seagul.co.uk/articles/2006/02/08/in-memory-sqlite-database-for-rails-testing">I wrote</a> a while back to create a <a href="http://wiki.rubyonrails.com/rails/pages/Plugins">rails plugin</a>, enabling the easy use of sqlite for testing.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/sqlite" rel="tag">sqlite</a>, 
                    
                      <a href="/articles/tag/testing" rel="tag">testing</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/05/13/improving-search-results">Improving search results</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 13 May 2006 07:44:00">
                    Sat, 13 May 2006 07:44:00
                  </span>
                </p>

                <p>This will be obvious to most people, especially anyone that&#8217;s taken the slightest bit of interest in their search engine rankings.  If text in the url matches the search query then that page is likely to get ranked higher than a page where the only the body matches the search query.</p>


	<p>There is an <a href="http://blog.claimid.com/2006/05/tips-and-tricks-your-name-in-the-url/">explanation</a> from the <a href="http://www.claimid.com">claimid</a> folks or you can see it for yourself by <a href="http://www.google.co.uk/search?hl=en&#38;q=chris+roos&#38;btnG=Google+Search">googling for me</a>.  My <a href="http://www.odeo.com">odeo</a> profile appears third in the results (as of right now).  The url contains my name but apart from that it is essentially a blank page containing no info about me.</p>


	<p>Anyhoo, the main point of this was to say that I emailed the claimid folks this morning to request they change my username from chrisjroos (my common moniker) to chrisroos.  I&#8217;m not even exaggerating when I say that they&#8217;d made the change and replied within ten minutes of my request.  That&#8217;s fantastic service.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/identity" rel="tag">identity</a>, 
                    
                      <a href="/articles/tag/seo" rel="tag">seo</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/05/12/using-active-record-models-in-rails-migrations">Using active record models in rails migrations</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 12 May 2006 16:32:00">
                    Fri, 12 May 2006 16:32:00
                  </span>
                </p>

                <p>I seem to remember that <a href="http://www.reevoo.com">we</a> first came across the &#8220;migrations out of sync with code&#8221; problems around the time that Scott Laird <a href="http://scottstuff.net/blog/articles/2005/10/31/migrating-in-two-dimensions">posted</a> about it regarding <a href="http://www.typosphere.org">typo</a>.</p>


	<p>Having just read <a href="http://www.reevoo.com/blogs/bengriffiths">Ben&#8217;s</a> <a href="http://www.reevoo.com/blogs/bengriffiths/2006/05/10/misrepresenting-rails-reliability/">post</a> about rails reliability, I was reminded again about the pitfalls of using model code in migrations.</p>


	<blockquote>
		<p>&#8220;Migrations can be problematic if the code under which the migration was written changes before the migration is deployed and released.&#8221;</p>
	</blockquote>


	<p>We&#8217;re a small team working on the same codebase, yet we still get bitten relatively frequently.  A while back we started to re-define our AR classes within our migrations to ensure that we weren&#8217;t relying on model code.  This has been <a href="http://rails.techno-weenie.net/tip/2006/2/23/safely_using_models_in_migrations">documented</a> <a href="http://wrath.rubyonrails.org/pipermail/rails-core/2006-February/000830.html">elsewhere</a>.  The typo codebase has gone slightly further and created a <a href="http://www.typosphere.org/trac/browser/trunk/lib/bare_migration.rb">BareMigration module</a> that takes care of some magic for you.  To be fair, I haven&#8217;t looked in detail so am not entirely sure what it does..</p>


	<p>The problem with re-defining models in the migrations is that it relies on you remembering to re-define them (I&#8217;m good at &#8216;forgetting&#8217; to do things unless I really have to).  There is nothing to stop you using the real models; that is, until someone complains that the migrations are broken and you have to fix it.</p>


	<p>We are currently using a slightly more robust (I think) solution that forces you to re-define any AR models that you wish to use in migrations.  It does this by hijacking the &#8216;zero&#8217; migration (a migration starting with 0 that gets loaded along with all other migrations but doesn&#8217;t interfere in any other way) to ensure any AR derived classes are defined in a module.  It&#8217;s naive but seems to work ok.</p>


	<p>If you don&#8217;t already have a zero migration, then create one.  The name is important as you will need to create an empty class of the same name in the file itself (for migrations to be happy).  Ours is called 000_rails_ext.rb.  The code is below.  Our code isn&#8217;t identical (yet) as I just realised that we had an ineffective call to super in the inherited method, now replaced with alias_method.</p>


<div class="typocode"><pre><code class="typocode_ruby">  <span class="keyword">class </span><span class="class">RailsExt</span>
  <span class="keyword">end</span>

  <span class="keyword">class </span><span class="class">ActiveRecord::Base</span>
    <span class="keyword">class </span><span class="punct">&lt;&lt;</span> <span class="constant">self</span>
      <span class="ident">alias_method</span> <span class="symbol">:__original__inherited</span><span class="punct">,</span> <span class="symbol">:inherited</span>
      <span class="keyword">def </span><span class="method">inherited</span><span class="punct">(</span><span class="ident">base</span><span class="punct">)</span>
        <span class="keyword">raise</span> <span class="punct">&quot;</span><span class="string">You're trying to use an ActiveRecord::Base derived class (--<span class="expr">#{base}</span>--) that is not defined in this migration.</span><span class="punct">&quot;</span> <span class="keyword">unless</span> <span class="ident">base</span><span class="punct">.</span><span class="ident">to_s</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">^Migration.*</span><span class="punct">/</span>
        <span class="ident">__original__inherited</span><span class="punct">(</span><span class="ident">base</span><span class="punct">)</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="constant">Dispatcher</span><span class="punct">.</span><span class="ident">reset_application!</span></code></pre></div>

	<p>The inherited callback is triggered everytime we define a class that inherits from ActiveRecord::Base.  All we do is check that its name starts with Migration and raise an error if not (failing fast is good).  The name is the fully qualified name and so includes namespaces.  This is good as it allows us to place all re-defined classes in a module named Migration&lt;number&gt;.  This module can then be included in the migration class itself.  Although I can&#8217;t remember exactly now, I think the reason we need to reset_application! is because we have some calls to our models in environment.rb.  These models would already be loaded and therefore any future references to them (in the migrations) would bypass our custom inherited method.  By resetting the app, we are sure that we have no AR models loaded.</p>


	<p>To re-define the models in the migration, we use something like..</p>


<div class="typocode"><pre><code class="typocode_ruby">  <span class="keyword">class </span><span class="class">MyFirstMigration</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Migration</span>
    <span class="keyword">def </span><span class="method">self.up</span>
    <span class="keyword">end</span>
    <span class="keyword">def </span><span class="method">self.down</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>

  <span class="keyword">module </span><span class="module">Migration001</span>
    <span class="keyword">class </span><span class="class">Person</span> <span class="punct">&lt;</span> <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
  <span class="constant">MyFirstMigration</span><span class="punct">.</span><span class="ident">send</span><span class="punct">(</span><span class="symbol">:include</span><span class="punct">,</span> <span class="constant">Migration001</span><span class="punct">)</span></code></pre></div>

	<p>Although sending the migration class the include message with the module isn&#8217;t great, we use it as it allows us to re-define all our classes below the actual migration.  If we were to place the module at the top then this wouldn&#8217;t be required but I feel that it gets in the way of being able to read the migration clearly.</p>


	<h3>A problem with this method and re-defining classes directly in the migration</h3>


	<p>Both methods create AR derived classes in a namespace that isn&#8217;t the root namespace.  We came across a problem where we were serializing the contents of one of these re-defined classes to the database from within our migration.  When we came to read the serialized data in our code, it didn&#8217;t &#8216;know&#8217; what a Migration001::Person was and so raised an exception.  Without thinking about it too much, I think this might cause problems with <span class="caps">STI</span> too (I&#8217;ve seen notes to this effect from the Typo migration solution).</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/migrations" rel="tag">migrations</a>, 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/05/06/storing-passwords-online">Storing passwords online</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 06 May 2006 10:05:00">
                    Sat, 06 May 2006 10:05:00
                  </span>
                </p>

                <p>I regularly access the Internet from three different locations.  Quite often, I will log into my bank account or other sites that have complicated login procedures (i.e. require more than just username and password) from each of these sites.  I&#8217;m not good at remembering this stuff so used to have it stored in some software called <a href="http://www.iliumsoft.com/site/ew/ewallet.html">eWallet</a> on the Pc.  This was fine when I was on one computer most of the time but as soon as I started using multiple computers, including a Mac, it became problematic.</p>


	<p>To get around the multiple computer problem, I ditched eWallet and now store all my info online, in a self-hosted slightly customised version of <a href="http://www.instiki.org">instiki</a>.  To achieve this in what I hope is some kind of secure way, I encrypt each set of data using <a href="http://www.gnupg.org">gpg</a>.  I then store this data in its own wiki page.  The wiki itself has very basic password protection and is not hosted over ssl but I&#8217;m thinking that because the decryption takes place on the client I should be ok.  Granted, it means that my secret key is on three computers and could therefore be compromised but I hope this is unlikely&#8230;</p>


	<p>The (hopefully) constant availability of my data outweighs the slight pain caused by having to decrypt the data each time.</p>


	<p>I&#8217;m genuinely not sure if this is a great idea or not regards security so maybe someone cleverer than I could advise if you come across this&#8230;</p>

                
              
                <h2>
                  <a href="/articles/2006/03/08/my-first-reevoo">My first reevoo!</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 08 Mar 2006 09:20:00">
                    Wed, 08 Mar 2006 09:20:00
                  </span>
                </p>

                <div class='hreview'>
  <span class='version' style='display:none'>0.2</span>
  <span class='type' style='display:none'>product</span>
  <div class='item'>
    <span class='fn'>Apple Ipod Shuffle 1 Gb</span>
    <ul class='identifiers' style='display: none'>
      <li><a class='url' href='http://www.reevoo.com/pages/apple_ipodshuffle1gb'>http://www.reevoo.com/pages/apple_ipodshuffle1gb</a></li><li><a class='url' href='urn:ean.ucc:718908929278'>urn:ean.ucc:718908929278</a></li>
    </ul>
  </div>
  <div class='description'>

	<p>I bought this recently to wile away the large amount of time I spend on trains.  I bought it just after Apple released the 1gb nano and therefore benefitted from the price drop to 69.</p>


	<p>Overall, it&#8217;s pretty good.  Although not the largest mp3 device on the market, there&#8217;s more than enough storage for my current needs.  I like the ability to resume playing from the last stopped position.  This is useful for spoken word audio as it would be difficult to get back to the exact same position without a display showing how far through you are.  One thing I didn&#8217;t know for certain until purchasing the unit was that there are two modes, shuffle and ordered play.  Again, the ordered play can come in useful for spoken word (podcast) content.</p>


	<p>Although I&#8217;m generally quite pleased I do have a few niggles with it.</p>


	<ul>
	<li>The itunes software doesn&#8217;t allow you to copy tracks from multiple pc&#8217;s (apparently all other ipod&#8217;s allow this).  If you have copied tracks from one pc and wish to then copy from another you first have to remove all tracks on the ipod.  You can actually copy the tracks directly from the ipod filesystem and play them on a different pc but I&#8217;m guessing that if they&#8217;ve been purchased through itunes and therefore drm&#8217;d up this might not work (I only tried it with downloaded podcasts).</li>
	</ul>


	<ul>
	<li>The cord used to place the shuffle round your neck is too short.  It hangs at about chest high making it difficult to get access to the shuffle if under clothing (which I&#8217;m guessing is pretty likely).</li>
	</ul>


	<ul>
	<li>I have a feeling it caused problems with my work mac (unconfirmed) when it was charging in the keyboard usb port.</li>
	</ul>


	<ul>
	<li>As someone that gets annoyed by hearing other peoples music, I try to ensure that I have the volume at a level that can&#8217;t be heard outside of my headphones.  This isn&#8217;t always easy with the supplied set (although I&#8217;d suggest this is more a problem of in-ear headphones rather than the apple specific ones).</li>
	</ul>


</div>

Rated <span class='rating'>3</span> by <span class='reviewer fn'>Chris</span>
  on <abbr class='dtreviewed' title='2006-03-08T08:53:00+00:00'>Mar 08, 2006</abbr>
</div>

<p>Find more real-world reviews or create your own at <a href='http://www.reevoo.com/'>Reevoo</a>.</p>

                
              
                <h2>
                  <a href="/articles/2006/03/08/rails-table-pluralization">Rails table pluralization</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 08 Mar 2006 07:48:00">
                    Wed, 08 Mar 2006 07:48:00
                  </span>
                </p>

                <p>I was talking to someone recently about the pluralisation of table names in <a href="http://www.rubyonrails.org">rails</a>.  It was grating him because some hand built queries no longer read very naturally.</p>


<div class="typocode"><pre><code class="typocode_sql">-- (in rails) requesting the forename of the 'first' person
SELECT forename FROM people WHERE people.id = 1;

-- would read better as
SELECT forename FROM person WHERE person.id = 1;</code></pre></div>

	<p><a href="http://po-ru.com/">Paul</a> (a colleague at <a href="http://www.reevoo.com">reevoo</a>) pointed out that there are two sides to the singular/plural table name debate.  You will always have some queries (as above) that will work better when the table is singular; and others (as below) that will work better when the table is plural.</p>


<div class="typocode"><pre><code class="typocode_sql">-- requesting all people having a country of 'uk'
SELECT * FROM person WHERE country = 'UK';

-- (in rails) would read better as
SELECT * FROM people WHERE country = 'UK';</code></pre></div>

	<p>Personally, because of the very small amount of hand written sql I&#8217;ve had to use with Rails this has never been an issue to me.  However, it did make me think about a slight adaptation to Active Record&#8230;</p>


	<p>By default (in Rails), you create a singular (active record) model (person) that maps to the plural table (people).  Although very convenient (it&#8217;s the reason I&#8217;ve rarely had to touch sql), it too suffers from the same problems outlined in the queries above.  I think the two statements below show the same sort of natural vs unnatural language that appears in the sql above.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="comment"># good english (acting on a single person)</span>
<span class="constant">Person</span><span class="punct">.</span><span class="ident">name</span> <span class="punct">=</span> <span class="punct">'</span><span class="string">chris</span><span class="punct">'</span>
<span class="constant">Person</span><span class="punct">.</span><span class="ident">save</span>

<span class="comment"># bad english (we are asking for multiple people)</span>
<span class="constant">Person</span><span class="punct">.</span><span class="ident">find</span><span class="punct">(</span><span class="symbol">:all</span><span class="punct">,</span> <span class="symbol">:conditions</span> <span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">country = 'uk'</span><span class="punct">&quot;)</span></code></pre></div>

	<p>The adaptation to active record I was thinking about would allow you to operate on both a Person and People, using the variant that made the code read more naturally.  That is, we could leave the Person.name example above as is, but change the Person.find to People.find<sup><a href="#fn1">1</a></sup>.  There are different ways to go about this but to get some of the way there with a little code (i.e. not having to manually create both singular and plural classes for each table); I came up with the following simple hack.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">ActiveRecord::Base</span>
  <span class="keyword">class </span><span class="punct">&lt;&lt;</span> <span class="constant">self</span>
    <span class="ident">alias_method</span> <span class="symbol">:__existing_inherited</span><span class="punct">,</span> <span class="symbol">:inherited</span>
    <span class="keyword">def </span><span class="method">inherited</span><span class="punct">(</span><span class="ident">child</span><span class="punct">)</span>
      <span class="ident">__existing_inherited</span><span class="punct">(</span><span class="ident">child</span><span class="punct">)</span>
      <span class="ident">plural_class</span> <span class="punct">=</span> <span class="ident">child</span><span class="punct">.</span><span class="ident">to_s</span><span class="punct">.</span><span class="ident">pluralize</span>
      <span class="keyword">unless</span> <span class="ident">plural_class</span> <span class="punct">=~</span> <span class="punct">/</span><span class="regex">#&lt;Class:.</span><span class="punct">/</span> <span class="keyword">or</span> <span class="constant">Object</span><span class="punct">.</span><span class="ident">constants</span><span class="punct">.</span><span class="ident">include?</span><span class="punct">(</span><span class="ident">plural_class</span><span class="punct">)</span>
        <span class="constant">Object</span><span class="punct">.</span><span class="ident">const_set</span><span class="punct">(</span><span class="ident">plural_class</span><span class="punct">,</span> <span class="constant">Class</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="ident">child</span><span class="punct">))</span>
      <span class="keyword">end</span>
    <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>Just add it to the bottom of your environment.rb file and when you first reference one of your singular classes it will automatically descend a plural class from it.</p>


	<p>There are lots of things wrong with this code and many better ways for it to be implemented but it was really just for me to see if I could do it.</p>


	<p id="fn1"><sup>1</sup> Boring and sad.  I was going to start that sentence with i.e. but wasn&#8217;t sure whether that was grammatically correct (I&#8217;m not very good at English).  I did a quick search and found that it translates as &#8216;that is&#8217; from the Latin which is much better.</p>

                
              
                <h2>
                  <a href="/articles/2006/03/06/cool-google-map-of-the-tube-network">Cool google map of the tube network...</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 06 Mar 2006 09:33:00">
                    Mon, 06 Mar 2006 09:33:00
                  </span>
                </p>

                <p>...<a href="http://tubejp.co.uk/">right here</a></p>

                
              
                <h2>
                  <a href="/articles/2006/03/05/installing-collaboa">Installing Collaboa</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sun, 05 Mar 2006 11:58:00">
                    Sun, 05 Mar 2006 11:58:00
                  </span>
                </p>

                <p>I just spent a few minutes installing <a href="http://www.collaboa.org">collaboa</a> on my <a href="http://www.freebsd.org">FreeBsd</a> server.</p>


	<p>I already had a number of the pre-requisites installed.  All that was outstanding was <a href="http://www.swig.org">swig</a>, the <a href="http://www.freshports.org/devel/subversion-ruby/">subversion-ruby bindings</a> and the <a href="http://www.freshports.org/converters/ruby-iconv/">ruby iconv bindings</a> which were all installed using packages.</p>


	<p>Collaboa is a <a href="http://www.rubyonrails.org">rails</a> alternative to <a href="http://www.edgewall.com/trac/">trac</a>, minus the wiki.  It basically provides a nice frontend to subversion and some project management&#8217;y type stuff.  I&#8217;m using it to host my <a href="http://dev.seagul.co.uk">poor attempts</a> at coding.</p>

                
              
                <h2>
                  <a href="/articles/2006/03/01/claimid-for-managing-online-identity">ClaimId for managing online identity</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 01 Mar 2006 08:47:00">
                    Wed, 01 Mar 2006 08:47:00
                  </span>
                </p>

                <p>I started reading about <a href="http://claimid.com">claim id</a> about a week ago, just as they were talking about launching a public beta.</p>


	<p>As soon as the beta was launched I signed up and added <a href="http://claimid.com/chrisjroos">some links</a> to content about/by me on the web.</p>


	<p>I like the approach they take; very simply grouping links based on their meaning to you.</p>


	<p>One of the things we want for <a href="http://www.reevoo.com">reevoo</a> is the concept of &#8216;my reviews&#8217;.  My personal preference has been to utilise one of many <a href="http://www.sixapart.com/typekey/index">existing</a> <a href="http://openid.net/">authentication</a> services; but something has changed in my mind since seeing claimid: sadly I can&#8217;t quite put my finger on it at present.</p>

                
              
                <h2>
                  <a href="/articles/2006/03/01/ruby-quiz-number-67-metakoans">Ruby Quiz number 67 (metakoans)</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 01 Mar 2006 08:40:00">
                    Wed, 01 Mar 2006 08:40:00
                  </span>
                </p>

                <p>I just finished my first <a href="http://www.rubyquiz.com">rubyquiz</a>.  Yay.  I take a look every now and then but never seem to find the time to spend on them.</p>


	<p>I made the time for <a href="http://rubyquiz.com/quiz67.html">metakoans</a> as it involved &#8216;meta-programming&#8217; which I&#8217;ve recently spent some time on at <a href="http://www.reevoo.com">work</a></p>


	<p>My solution is here, and although it passes all the tests of the quiz it&#8217;s probably not great as this stuff still confuses me somewhat.  I didn&#8217;t take a look at any other solutions (although I will shortly) so any similarity is coincidental.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">Object</span>

  <span class="keyword">def </span><span class="method">attribute</span><span class="punct">(</span><span class="ident">arg</span><span class="punct">,</span> <span class="punct">&amp;</span><span class="ident">block</span><span class="punct">)</span>

    <span class="keyword">if</span> <span class="ident">arg</span><span class="punct">.</span><span class="keyword">class </span><span class="class">==</span> <span class="ident">Hash</span>
      <span class="ident">attribute</span> <span class="punct">=</span> <span class="ident">arg</span><span class="punct">.</span><span class="ident">keys</span><span class="punct">[</span><span class="number">0</span><span class="punct">]</span>
      <span class="ident">value</span> <span class="punct">=</span> <span class="ident">arg</span><span class="punct">.</span><span class="ident">values</span><span class="punct">[</span><span class="number">0</span><span class="punct">]</span>
    <span class="keyword">else</span>
      <span class="ident">attribute</span> <span class="punct">=</span> <span class="ident">arg</span>
      <span class="ident">value</span> <span class="punct">=</span> <span class="ident">block</span> <span class="punct">?</span> <span class="ident">block</span> <span class="punct">:</span> <span class="constant">nil</span>
    <span class="keyword">end</span>

    <span class="ident">class_eval</span> <span class="keyword">do</span>

      <span class="ident">attr_writer</span> <span class="ident">attribute</span>

      <span class="ident">define_method</span><span class="punct">(</span><span class="ident">attribute</span><span class="punct">)</span> <span class="keyword">do</span>
        <span class="keyword">unless</span> <span class="ident">instance_variable_get</span><span class="punct">(&quot;</span><span class="string">@<span class="expr">#{attribute}</span></span><span class="punct">&quot;)</span>
          <span class="ident">default_value</span> <span class="punct">=</span> <span class="punct">(</span><span class="ident">value</span><span class="punct">.</span><span class="keyword">class </span><span class="class">==</span> <span class="ident">Proc</span><span class="punct">)</span> <span class="punct">?</span> <span class="ident">instance_eval</span><span class="punct">(&amp;</span><span class="ident">value</span><span class="punct">)</span> <span class="punct">:</span> <span class="ident">value</span>
          <span class="ident">instance_variable_set</span><span class="punct">(&quot;</span><span class="string">@<span class="expr">#{attribute}</span></span><span class="punct">&quot;,</span> <span class="ident">default_value</span><span class="punct">)</span>
        <span class="keyword">end</span>
        <span class="ident">instance_variable_get</span><span class="punct">(&quot;</span><span class="string">@<span class="expr">#{attribute}</span></span><span class="punct">&quot;)</span>
      <span class="keyword">end</span>

      <span class="ident">define_method</span><span class="punct">(&quot;</span><span class="string"><span class="expr">#{attribute}</span>?</span><span class="punct">&quot;)</span> <span class="keyword">do</span>
        <span class="ident">instance_variable_get</span><span class="punct">(&quot;</span><span class="string">@<span class="expr">#{attribute}</span></span><span class="punct">&quot;)</span> <span class="punct">?</span> <span class="constant">true</span> <span class="punct">:</span> <span class="constant">false</span>
      <span class="keyword">end</span>

    <span class="keyword">end</span>

  <span class="keyword">end</span>

<span class="keyword">end</span></code></pre></div>

                
              
                <h2>
                  <a href="/articles/2006/02/27/claiming-my-blog-on-technorati">Claiming my blog on technorati</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 27 Feb 2006 14:40:00">
                    Mon, 27 Feb 2006 14:40:00
                  </span>
                </p>

                <p>Not entirely sure what this does&#8230;</p>


	<p><a href="http://technorati.com/claim/yvtpcjveej">Technorati Profile</a></p>

                
              
                <h2>
                  <a href="/articles/2006/02/24/some-freebsd-housekeeping">Some Freebsd housekeeping</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Fri, 24 Feb 2006 15:17:00">
                    Fri, 24 Feb 2006 15:17:00
                  </span>
                </p>

                <p>I use <a href="http://www.exonetric.com/">exonetric</a> to host this <a href="http://www.typosphere.org">typo</a> instance.  It&#8217;s on a <a href="http://www.freebsd.org">freebsd</a> virtual server so I have to maintain everything.  For a long time, I&#8217;ve been using <a href="http://www.mysql.org">mysql</a> 4.  This is fine apart from a problem during initial installation causing it not to start automatically on machine restart.  This meant that whenever the virtual machine was rebooted I had to manually restart mysql, which basically wouldn&#8217;t happen until I actually noticed it &#8211; not cool.</p>


	<p>I spent the time today to upgrade to mysql 5.  Luckily this solved the auto start problem and mysql now comes up with the machine.</p>


	<p>Although incredibly interesting (hmm) that wasn&#8217;t really the point of the post.  This is&#8230;  Since using freebsd I&#8217;ve always relied on <a href="http://www.freebsd.org/ports/">ports</a> (instructions for compilation of software) for the installation of software.  When installing mysql today, I used the pre-compiled package binary instead.  I&#8217;m amazed at how much faster it is; and now really can&#8217;t believe I&#8217;ve been bothering with the ports all this time.  I guess it was some kind of anal retentive control I thought I was getting by compiling the software myself; when infact I was only ever compiling with the default options and just wasting time&#8230;  Ho hum.</p>


	<p>Two moral&#8217;s here me thinks.  Use packages if you don&#8217;t know what you&#8217;re doing (I don&#8217;t).  Don&#8217;t mess around with things you don&#8217;t understand (manually deleting ports dir before un-installing ports and then expecting packages to just overwrite them.  Oh well, it seems ok).</p>

                
              
                <h2>
                  <a href="/articles/2006/02/23/rails-rake-testing-without-database">Rails rake testing without database</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 23 Feb 2006 16:46:00">
                    Thu, 23 Feb 2006 16:46:00
                  </span>
                </p>

                <p>Continuing from the <a href="http://blog.seagul.co.uk/articles/2006/02/23/rails-testing-without-database">previous post</a>, it appears that the rake testing tasks are also tightly coupled to active record.</p>


	<p>This feels quite dirty, but I&#8217;ve managed to get round it by manipulating the tasks from the outside (they are buried in the rails libs).</p>


	<p>To replicate, create a new file called &#8216;default.rake&#8217; in the lib/tasks/ directory within your rails project, and paste in the following code.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">::</span><span class="constant">TASKS</span><span class="punct">.</span><span class="ident">delete</span><span class="punct">('</span><span class="string">default</span><span class="punct">')</span>
<span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">[</span><span class="symbol">:test_units</span><span class="punct">].</span><span class="ident">instance_variable_set</span><span class="punct">(</span><span class="symbol">:@prerequisites</span><span class="punct">,</span> <span class="punct">[])</span>
<span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">[</span><span class="symbol">:test_functional</span><span class="punct">].</span><span class="ident">instance_variable_set</span><span class="punct">(</span><span class="symbol">:@prerequisites</span><span class="punct">,</span> <span class="punct">[])</span>

<span class="ident">task</span> <span class="symbol">:default</span> <span class="keyword">do</span>
  <span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">[</span><span class="symbol">:test_units</span><span class="punct">].</span><span class="ident">invoke</span>      <span class="keyword">rescue</span> <span class="ident">got_error</span> <span class="punct">=</span> <span class="constant">true</span>
  <span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">[</span><span class="symbol">:test_functional</span><span class="punct">].</span><span class="ident">invoke</span> <span class="keyword">rescue</span> <span class="ident">got_error</span> <span class="punct">=</span> <span class="constant">true</span>
  <span class="keyword">raise</span> <span class="punct">&quot;</span><span class="string">Test failures</span><span class="punct">&quot;</span> <span class="keyword">if</span> <span class="ident">got_error</span>
<span class="keyword">end</span></code></pre></div>

	<p>Because this relies on the internal implementation of rake (instance variable names and <span class="caps">TASKS</span> constant) it might well do very bad things to versions that aren&#8217;t 0.6.2.</p>


	<p><strong>Update 17:20</strong></p>


	<p>Just realised that I don&#8217;t need most of the code above.  All you actually need in default.rake is as follows.  Stoopid Chris.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">[</span><span class="symbol">:test_units</span><span class="punct">].</span><span class="ident">instance_variable_set</span><span class="punct">(</span><span class="symbol">:@prerequisites</span><span class="punct">,</span> <span class="punct">[])</span>
<span class="constant">Rake</span><span class="punct">::</span><span class="constant">Task</span><span class="punct">[</span><span class="symbol">:test_functional</span><span class="punct">].</span><span class="ident">instance_variable_set</span><span class="punct">(</span><span class="symbol">:@prerequisites</span><span class="punct">,</span> <span class="punct">[])</span></code></pre></div>

                
              
                <h2>
                  <a href="/articles/2006/02/23/rails-testing-without-database">Rails testing without database</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 23 Feb 2006 08:16:00">
                    Thu, 23 Feb 2006 08:16:00
                  </span>
                </p>

                <p>Just yesterday I wanted to create a very quick rails app that didn&#8217;t rely on a database.</p>


	<p>I removed :active_record from the frameworks loaded in evironment, but apparently this wasn&#8217;t quite enough.  The setup and teardown methods in Test::Unit::TestCase were still attempting to load fixtures (which implies that active record is still present somewhere), which require the presence of a database.  This was causing tests not to run.  Having had a quick look at how active record intercepts the setup and teardown methods, it was relatively simple to stop it from doing so.</p>


	<p>Just add the code below within the Test::Unit::TestCase declaration in test_helper.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">def </span><span class="method">self.dont_use_fixtures</span>
  <span class="ident">class_eval</span> <span class="keyword">do</span>
    <span class="keyword">def </span><span class="method">self.method_added</span><span class="punct">(</span><span class="ident">method</span><span class="punct">);</span> <span class="keyword">end</span>
    <span class="keyword">def </span><span class="method">setup</span><span class="punct">;</span> <span class="keyword">end</span>
    <span class="keyword">def </span><span class="method">teardown</span><span class="punct">;</span> <span class="keyword">end</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>This still requires that you add dont_use_fixtures into each test class definition.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">class </span><span class="class">MyTest</span> <span class="punct">&lt;</span> <span class="constant">Test</span><span class="punct">::</span><span class="constant">Unit</span><span class="punct">::</span><span class="constant">TestCase</span>
  <span class="ident">dont_use_fixtures</span>
  <span class="keyword">def </span><span class="method">test_</span>
    <span class="comment"># my first test</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></code></pre></div>

	<p>Having just written this it&#8217;s obvious now that it would make more sense to not require the declaration in each test class (as we supposedly don&#8217;t even have access to active record).  We should probably also play fair and pass messages back to our parent if method_added isn&#8217;t being called with either setup or teardown.</p>


	<p>The new code becomes (again, in Test::Unit::TestCase definition in test_helper).</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">def </span><span class="method">self.method_added</span><span class="punct">(</span><span class="ident">method</span><span class="punct">)</span>
  <span class="keyword">super</span> <span class="keyword">unless</span> <span class="punct">[</span><span class="symbol">:setup</span><span class="punct">,</span> <span class="symbol">:teardown</span><span class="punct">].</span><span class="ident">include?</span><span class="punct">(</span><span class="ident">method</span><span class="punct">.</span><span class="ident">to_sym</span><span class="punct">)</span>
<span class="keyword">end</span>
<span class="keyword">def </span><span class="method">setup</span><span class="punct">;</span> <span class="keyword">end</span>
<span class="keyword">def </span><span class="method">teardown</span><span class="punct">;</span> <span class="keyword">end</span></code></pre></div>

	<p>This appears to work ok&#8230;</p>

                
              
                <h2>
                  <a href="/articles/2006/02/18/alternative-to-putty-ssh-on-windows">Alternative to Putty Ssh on Windows</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Sat, 18 Feb 2006 12:36:00">
                    Sat, 18 Feb 2006 12:36:00
                  </span>
                </p>

                <p>I&#8217;ve used <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/">putty</a> for all my ssh needs on windows for a long time now.  It&#8217;s great but certainly lacks a little polish in some areas.</p>


	<p>The one feature I really wanted was tabbed sessions.  After a little searching I came across a comment on this <a href="http://www.jroller.com/page/thuss?entry=tabbed_terminals_for_windows_redux">post</a> that mentioned an open source alternative called <a href="http://en.poderosa.org/">poderosa</a>.  I just got round to downloading and I must say that so far it looks great.</p>


	<p>The only potential downside is that it relies on the .net framework (which I&#8217;d so far managed without) so it&#8217;s not quite as light weight as putty but good none-the-less.</p>

                
              
                <h2>
                  <a href="/articles/2006/02/09/reviews-reevoos-reviews">Reviews Reevoos Reviews</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 09 Feb 2006 07:49:00">
                    Thu, 09 Feb 2006 07:49:00
                  </span>
                </p>

                <p>We&#8217;ve just recently started poking our head above the radar at <a href="http://www.reevoo.com">work</a> regarding our &#8216;new&#8217; (been around for a while but just undergone a re-design) review site &#8211; <a href="http://www.reevoo.com">Reevoo</a>.</p>


	<p>Take a look, why not.</p>


	<p>The main point of interest (for me) is that we are now aggregating reviews from blog entries.  I&#8217;ve been commuting a lot recently and have had plenty of time to read (check my <a href="http://allconsuming.net/person/chrisjroos">recent consumption</a>).  I&#8217;m more than happy to write reviews of these books but I really cannot be bothered to go over the <a href="http://www.amazon.co.uk">Amazon</a>, or anywhere else for that matter, to do so.  Now I don&#8217;t have to; I can write the review right here and have it appear on any site that I can <a href="http://www.reevoo.com/web_services/manual_ping">notify</a>.</p>


	<p>Cool huh.</p>

                
              
                <h2>
                  <a href="/articles/2006/02/08/in-memory-sqlite-database-for-rails-testing">In memory sqlite database for rails testing</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Wed, 08 Feb 2006 08:54:00">
                    Wed, 08 Feb 2006 08:54:00
                  </span>
                </p>

                <p><strong>Update 12th June 2006</strong></p>


	<p>There is now a <a href="http://nubyonrails.com/articles/2006/06/01/san-francisco-sqlite3-memory-tests-asteroids">plugin</a> from <a href="http://nubyonrails.com/">Geoffrey Grosenbach</a> that encapsulates this hack.</p>


	<p><del>-</del></p>


	<p>I finally took some time to get the <a href="http://www.sqlite.org">sqlite</a> in memory database working correctly for testing <a href="http://www.rubyonrails.com">Rails</a> apps.</p>


	<p>It appears to be available by default (appearing in the example database.yml file) as</p>


<div class="typocode"><pre><code class="typocode_default">sqlite3_in_memory_example:
  adapter: sqlite3
  database: &quot;:memory:&quot;</code></pre></div>

	<p>Unfortunately, it doesn&#8217;t appear to be quite as easy as just replacing sqlite3_in_memory_example with test&#8230;  The main problem being that in-memory databases have a tendency not to hang around (odd that).</p>


	<p>My solution (which has every chance of being bad or downright incorrect) is to force the creation of the database in memory at the beginning of the tests.</p>


	<p>The current implementation relies on either schema.rb being present or comprehensive migrations (i.e. you can use migrations to get a database from zero to your current development status).</p>


	<p>If you wish to use the schema.rb approach then uncomment the following line in your environment.rb file.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="ident">config</span><span class="punct">.</span><span class="ident">active_record</span><span class="punct">.</span><span class="ident">schema_format</span> <span class="punct">=</span> <span class="symbol">:ruby</span></code></pre></div>

	<p>Un-commenting this option ensures that the database schema is exported to schema.rb rather than adapter specific sql (ENV_database.sql).</p>


	<p>Add the following code right below the &#8221;# Include your application configuration below&#8221; line in environment.rb.</p>


<div class="typocode"><pre><code class="typocode_ruby"><span class="keyword">def </span><span class="method">in_memory_database?</span>
  <span class="constant">ENV</span><span class="punct">[&quot;</span><span class="string">RAILS_ENV</span><span class="punct">&quot;]</span> <span class="punct">==</span> <span class="punct">&quot;</span><span class="string">test</span><span class="punct">&quot;</span> <span class="keyword">and</span> 
  <span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">Base</span><span class="punct">.</span><span class="ident">connection</span><span class="punct">.</span><span class="keyword">class </span><span class="class">==</span> <span class="ident">ActiveRecord</span><span class="punct">::</span><span class="ident">ConnectionAdapters</span><span class="punct">::</span><span class="ident">SQLiteAdapter</span> <span class="ident">and</span>
  <span class="constant">Rails</span><span class="punct">::</span><span class="constant">Configuration</span><span class="punct">.</span><span class="ident">new</span><span class="punct">.</span><span class="ident">database_configuration</span><span class="punct">['</span><span class="string">test</span><span class="punct">']['</span><span class="string">database</span><span class="punct">']</span> <span class="punct">==</span> <span class="punct">'</span><span class="string">:memory:</span><span class="punct">'</span>
<span class="keyword">end</span>

<span class="keyword">if</span> <span class="ident">in_memory_database?</span>
  <span class="ident">puts</span> <span class="punct">&quot;</span><span class="string">creating sqlite in memory database</span><span class="punct">&quot;</span>
  <span class="ident">load</span> <span class="punct">&quot;</span><span class="string"><span class="expr">#{RAILS_ROOT}</span>/db/schema.rb</span><span class="punct">&quot;</span> <span class="comment"># use db agnostic schema by default</span>
<span class="comment">#  ActiveRecord::Migrator.up('db/migrate') # use migrations</span>
<span class="keyword">end</span></code></pre></div>

	<p>The reason for adding this code at this point and not just at the end of the environment file is that you may have further logic in environment that actually relies on the database being present.</p>


	<p>If you are running your tests using rake then it shouldn&#8217;t matter whether you use the schema or migrations to create the database.  This is because the rake test tasks rely on the test database being set-up, which involves exporting the development db schema to file.</p>


	<p>If you wish to run tests individually (which, of course, you do) and you choose to use the schema to create your test scructure, you must make sure that it first exists.  The easiest way is to run the following rake task.</p>


<div class="typocode"><pre><code class="typocode_default">rake db_schema_dump</code></pre></div>

	<p>That should be all there is to it; although I must confess that I&#8217;ve seen additional strange problems when running certain tests against the sqlite in-memory database.  In certain cases I think these may be fixture related.  Where, in <a href="http://www.mysql.org">MySql</a>, you seem to be able to omit required fields (not null) from a fixtures file, sqlite requires their presence.  In other cases; who knows&#8230;</p>


	<h3>Testing your sqlite installation</h3>


	<p>One final note that may be of interest.  When I first started playing with sqlite3 with Ruby it seems that I didn&#8217;t have it installed correctly (relying on pre-installed sqlite and the sqlite3-ruby gem).  As per <a href="http://wiki.rubyonrails.org/rails/pages/HowtoUseSQLite">this article</a> I had to un-install sqlite3-ruby gem and first install the swig port before re-installing sqlite3-ruby gem.  You can test for the correct installation by running the <a href="http://wiki.rubyonrails.com/rails/pages/ActiveRecord">Active Record</a> tests against sqlite by following these steps.</p>


	<ul>
	<li>Change directory to Active Record tests (rails/activerecord/test)</li>
	</ul>


	<ul>
	<li>Run base_test.rb, supplying the location of the sqlite3 connection to the load path.</li>
	</ul>


	<ul>
	<li><code>ruby -I "connections/native_sqlite3/" base_test.rb</code></li>
	</ul>


	<p>You can also run the tests using the sqlite3 in memory connection.  To do so, perform these actions before running the tests as above.</p>


	<ul>
	<li>Remove the standard sqlite3 connection</li>
	</ul>


	<ul>
	<li><code>rm connections/native_sqlite3/connection.rb</code></li>
	</ul>


	<ul>
	<li>Rename in_memory_connection.rb as connection.rb</li>
	</ul>


	<ul>
	<li><code>mv connections/in_memory_connection.rb connections/connection.rb</code></li>
	</ul>


	<p>I&#8217;d suggest doing this against an svn checked out copy of rails, purely due to the these at which the changes can be reverted.</p>


	<h3>Useless stats</h3>


	<p>Changing to in-memory testing shaved about 33% off the running time of our unit tests.</p>

                
                  <p>
                    Tags 
                    
                      <a href="/articles/tag/rails" rel="tag">rails</a>, 
                    
                      <a href="/articles/tag/ruby" rel="tag">ruby</a>, 
                    
                      <a href="/articles/tag/sqlite" rel="tag">sqlite</a>, 
                    
                      <a href="/articles/tag/test" rel="tag">test</a>, 
                    
                  </p>
                
              
                <h2>
                  <a href="/articles/2006/01/19/idea-typo-sidebar-for-allconsuming">Idea - Typo sidebar for allconsuming</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 19 Jan 2006 13:39:00">
                    Thu, 19 Jan 2006 13:39:00
                  </span>
                </p>

                <p>There currently doesn&#8217;t seem to be a <a href="http://typo.leetsoft.com">typo</a> sidebar for <a href="http://www.allsonsuming.net">allconsuming</a> &#8211; I kinda think there should be.</p>


	<p>Having said that, maybe it&#8217;s not required as allconsuming already provide javascript to insert the contents into your blog.</p>


	<p>We&#8217;ll see.</p>

                
              
                <h2>
                  <a href="/articles/2006/01/17/one-of-the-reasons-why-i-really-really-dont-like-uk2">(One of the reasons) Why I really really don't like uk2</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Tue, 17 Jan 2006 07:42:00">
                    Tue, 17 Jan 2006 07:42:00
                  </span>
                </p>

                <p>I had the mis-fortune to sign-up with uk2.net (intentionally not linked &#8211; how petty) quite some time ago, registering domains at first and subsequently using their free email service.</p>


	<p>Although there are lots of things wrong with them; the one that has annoyed me for a while, and has done so again this morning; is their lack of &#8216;remind me of my password&#8217;.</p>


	<p>It would appear that one of my old email addresses is still active on their server &#8211; and is still happily forwarding all mail to my primary email account.</p>


	<p>Luckily, the only mail to come through this account is spam.  Great.</p>


	<p>As this account is so very very old I have absolutely no recollection of the password used.  I&#8217;ve tried to re-set it or remove the account in the past; to no avail.</p>


	<p>I just tried again this morning &#8211; still no luck.  Apparently I can <a href="http://mailme.uk2net.com/max_password.html">buy the privilege</a> of a password reset/reminder by sending the princely sum of 10.  Just like all the other email services on the web&#8230;  Yeah.  Right.</p>

                
              
                <h2>
                  <a href="/articles/2006/01/16/douban-as-alternative-to-allconsuming">douban as alternative to allconsuming?</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 16 Jan 2006 11:52:05">
                    Mon, 16 Jan 2006 11:52:05
                  </span>
                </p>

                <p>Looks to me like <a href="http://www.douban.net">douban</a> is very similar to <a href="http://www.allconsuming.net">all consuming</a>.  I think the difference may be the ability to add more structured rating to the content in douban.  Not sure though.</p>

                
              
                <h2>
                  <a href="/articles/2006/01/12/idea-track-daily-spending">Idea - Track daily spending...</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 12 Jan 2006 10:16:58">
                    Thu, 12 Jan 2006 10:16:58
                  </span>
                </p>

                <p>... and aggregate the data.  Compare average daily spend between people.</p>


	<p>Doesn&#8217;t ask for any personal data, including what it was spent on, just how much.  May or (most likely) may not be useful in a social kinda way.</p>


	<p>Probably not.</p>

                
              
                <h2>
                  <a href="/articles/2006/01/12/aggregaation-is-the-way-forward">Aggregaation is the way forward...</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Thu, 12 Jan 2006 10:01:52">
                    Thu, 12 Jan 2006 10:01:52
                  </span>
                </p>

                <p>idea&#8217;s, list&#8217;s (lists of ideas maybe..), money??</p>

                
              
                <h2>
                  <a href="/articles/2006/01/09/inland-revenue-as-bad-as-ticket-master">Inland Revenue as bad as Ticket Master</a>
                </h2>
                <p class="postedOn">
                  Posted by Chris Roos
                  <span class="typo_date" title="Mon, 09 Jan 2006 14:23:47">
                    Mon, 09 Jan 2006 14:23:47
                  </span>
                </p>

                <p>Well it seems that the inland revenue have taken a leaf out of ticket master&#8217;s &#8220;school of less secure passwords&#8221; book.  Your password must be between 8 and 12 characters and be alphanumeric.</p>


	<p>Completely and utterly pathetic.</p>

                
              

            </div>
          </div>
        </div>
        <div class="yui-b">
          <img class="avatar" src="/images/me.jpg" width="170px" height="111px" alt="Me">
          
          <ul class="navigation">
            <li>
              <a href="/contents">contents</a>
            </li>
            <li>
              <a href="http://flickr.com/photos/chrisjroos">flickr</a>
            </li>
          </ul>
          
          <div id="twitter_div">
            <h3><a href="http://twitter.com/chrisroos">twitter</a></h3>
            <ul id="twitter_update_list"></ul>
          </div>
          
          <div id="deliciousContainer">
            <h3><a href="http://del.icio.us/chrisjroos">del.icio.us</a></h3>
          </div>
        </div>
      </div>
    </div>
    <div id="ft">
      <!-- Footer -->
    </div>
    
    <script type="text/javascript" src="http://twitter.com/javascripts/blogger.js"></script>
    <script type="text/javascript" src="http://twitter.com/statuses/user_timeline/chrisroos.json?callback=twitterCallback2&amp;count=5"></script>
    
    <script type="text/javascript" src="http://del.icio.us/feeds/json/chrisjroos?count=5"></script>
    <script type="text/javascript" src="/javascripts/delicious.js"></script>
  
    <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
      if (typeof(_gat) != 'undefined') {
        var pageTracker = _gat._getTracker("UA-160238-1");
        pageTracker._initData();
        pageTracker._trackPageview();
      }
    </script>
  </body>

</html>
